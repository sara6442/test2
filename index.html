<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مهامي - تطبيق إدارة المهام المتقدم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    /* ========== المتغيرات والأساسيات ========== */
    :root {
        --primary-color: #4361ee;
        --secondary-color: #3a0ca3;
        --accent-color: #7209b7;
        --success-color: #4cc9f0;
        --danger-color: #f72585;
        --warning-color: #f8961e;
        --light-color: #f8f9fa;
        --dark-color: #212529;
        --gray-color: #6c757d;
        --border-radius: 12px;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --transition: all 0.3s ease;
        
        /* ثيم افتراضي (أزرق) */
        --theme-bg: #f5f7fb;
        --theme-sidebar: linear-gradient(180deg, #4361ee, #3a0ca3);
        --theme-text: #212529;
        --theme-card: white;
        --theme-border: #dee2e6;
        --theme-primary: #4361ee;
        --theme-hover: #3a0ca3;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--theme-bg);
        color: var(--theme-text);
        direction: rtl;
        min-height: 100vh;
        transition: var(--transition);
    }
    
    /* ========== تنسيقات الثيمات ========== */
    .theme-dark {
        --theme-bg: #121212;
        --theme-sidebar: linear-gradient(180deg, #2d3748, #1a202c);
        --theme-text: #e2e8f0;
        --theme-card: #2d3748;
        --theme-border: #4a5568;
        --theme-primary: #4299e1;
        --theme-hover: #63b3ed;
    }
    
    .theme-light {
        --theme-bg: #ffffff;
        --theme-sidebar: linear-gradient(180deg, #f7fafc, #edf2f7);
        --theme-text: #000000; /* تغيير لون الخط إلى أسود */
        --theme-card: #f7fafc;
        --theme-border: #e2e8f0;
        --theme-primary: #4299e1;
        --theme-hover: #63b3ed;
    }
    
    .theme-blue {
        --theme-bg: #f5f7fb;
        --theme-sidebar: linear-gradient(180deg, #4361ee, #3a0ca3);
        --theme-text: #212529;
        --theme-card: white;
        --theme-border: #dee2e6;
        --theme-primary: #4361ee;
        --theme-hover: #3a0ca3;
    }
    
    .theme-beige {
        --theme-bg: #fefaf6;
        --theme-sidebar: linear-gradient(180deg, #d7ccc8, #bcaaa4);
        --theme-text: #5d4037;
        --theme-card: white;
        --theme-border: #d7ccc8;
        --theme-primary: #8d6e63;
        --theme-hover: #6d4c41;
    }
    
    /* ========== الهيكل الرئيسي ========== */
    .app-container {
        display: flex;
        min-height: 100vh;
    }
    
    /* الشريط الجانبي */
    .sidebar {
        width: 280px;
        background: var(--theme-sidebar);
        color: var(--theme-text);
        padding: 20px 0;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        height: 100vh;
        z-index: 100;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
    }
    
    .logo {
        padding: 0 20px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 20px;
    }
    
    .logo h1 {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.5rem;
        color: white;
    }
    
    .nav-menu {
        padding: 0 15px;
        flex: 1;
    }
    
    .nav-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        border-radius: 10px;
        margin-bottom: 8px;
        transition: var(--transition);
        cursor: pointer;
        background: rgba(255, 255, 255, 0.1);
    }
    
    .nav-item:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateX(-5px);
    }
    
    .nav-item.active {
        background: rgba(255, 255, 255, 0.3);
        font-weight: 600;
        border-right: 4px solid white;
    }
    
    .nav-item i {
        font-size: 1.2rem;
        width: 24px;
        text-align: center;
    }
    
    /* زر الإعدادات في الأسفل */
    .sidebar-footer {
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .settings-btn {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        color: rgba(255, 255, 255, 0.9);
        background: rgba(255, 255, 255, 0.1);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        width: 100%;
        font-size: 1rem;
    }
    
    .settings-btn:hover {
        background: rgba(255, 255, 255, 0.2);
    }
    
    /* نافذة اختيار الثيم */
    .theme-popup {
        position: absolute;
        bottom: 70px;
        right: 20px;
        background: var(--theme-card);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--theme-border);
        display: none;
        z-index: 1000;
        min-width: 200px;
    }
    
    .theme-popup.active {
        display: block;
    }
    
    .theme-popup h4 {
        margin-bottom: 15px;
        color: var(--theme-text);
        text-align: center;
    }
    
    .theme-options {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
    }
    
    .theme-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        border: 2px solid transparent;
    }
    
    .theme-option:hover {
        background: var(--theme-border);
    }
    
    .theme-option.active {
        border-color: var(--theme-primary);
        background: rgba(67, 97, 238, 0.1);
    }
    
    .theme-preview {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid var(--theme-border);
    }
    
    .theme-name {
        font-size: 0.85rem;
        color: var(--theme-text);
    }
    
    .theme-dark-preview { background: linear-gradient(45deg, #2d3748, #1a202c); }
    .theme-light-preview { background: linear-gradient(45deg, #f7fafc, #edf2f7); }
    .theme-blue-preview { background: linear-gradient(45deg, #4361ee, #3a0ca3); }
    .theme-beige-preview { background: linear-gradient(45deg, #d7ccc8, #bcaaa4); }
    
    /* المحتوى الرئيسي */
    .main-content {
        flex: 1;
        margin-right: 280px;
        padding: 25px;
        transition: var(--transition);
    }
    
    /* ========== الهيدر ========== */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 25px;
        background: var(--theme-card);
        border-radius: var(--border-radius);
        box-shadow: var(--box-shadow);
        border: 1px solid var(--theme-border);
    }
    
    .header-left h1 {
        color: var(--theme-primary);
        margin-bottom: 8px;
        font-size: 1.8rem;
    }
    
    .current-date {
        color: var(--gray-color);
        font-size: 0.95rem;
    }
    
    /* ========== الأزرار ========== */
    .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: var(--transition);
        font-weight: 500;
    }
    
    .btn-primary {
        background: var(--theme-primary);
        color: white;
    }
    
    .btn-primary:hover {
        background: var(--theme-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn-secondary {
        background: var(--theme-card);
        color: var(--theme-text);
        border: 1px solid var(--theme-border);
    }
    
    .btn-secondary:hover {
        background: var(--theme-border);
        transform: translateY(-2px);
    }
    
    .btn-danger {
        background: var(--danger-color);
        color: white;
    }
    
    .btn-danger:hover {
        background: #d9048e;
        transform: translateY(-2px);
    }
    
    .btn-success {
        background: var(--success-color);
        color: white;
    }
    
    .btn-success:hover {
        background: #3ab5e0;
        transform: translateY(-2px);
    }
    
    .btn-sm {
        padding: 8px 16px;
        font-size: 0.9rem;
        border-radius: 8px;
    }
    
    /* ========== منطقة المحتوى ========== */
    .content-area {
        background: var(--theme-card);
        border-radius: var(--border-radius);
        padding: 30px;
        box-shadow: var(--box-shadow);
        min-height: 500px;
        border: 1px solid var(--theme-border);
        transition: var(--transition);
    }
    
    .view {
        display: none;
    }
    
    .view.active {
        display: block;
    }
    
    /* ========== عرض المهام ========== */
    .tasks-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .task-card {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 20px;
        background: var(--theme-card);
        border-radius: 12px;
        border-right: 5px solid var(--theme-primary);
        transition: var(--transition);
        position: relative;
        border: 1px solid var(--theme-border);
    }
    
    .task-card:hover {
        transform: translateX(-8px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    }
    
    .task-card.completed {
        opacity: 0.7;
        border-color: var(--success-color);
        order: 999; /* يجعل المهام المكتملة في الأسفل */
    }
    
    .task-card.overdue {
        border-color: var(--danger-color);
        background: rgba(247, 37, 133, 0.05);
        order: -1; /* يجعل المهام المتأخرة في الأعلى */
    }
    
    .task-card.completed .task-title {
        text-decoration: line-through;
        color: var(--gray-color);
    }
    
    .task-checkbox {
        width: 22px;
        height: 22px;
        cursor: pointer;
        accent-color: var(--theme-primary);
    }
    
    .task-content {
        flex: 1;
    }
    
    .task-title {
        font-weight: 600;
        margin-bottom: 8px;
        font-size: 1.1rem;
    }
    
    .task-description {
        color: var(--gray-color);
        font-size: 0.95rem;
        margin-bottom: 12px;
        line-height: 1.5;
    }
    
    .task-meta {
        display: flex;
        gap: 20px;
        font-size: 0.9rem;
        color: var(--gray-color);
    }
    
    .task-meta-item {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .task-actions {
        display: flex;
        gap: 10px;
        opacity: 0;
        transition: var(--transition);
    }
    
    .task-card:hover .task-actions {
        opacity: 1;
    }
    
    /* ========== مرشحات المهام ========== */
    .task-filters {
        display: flex;
        gap: 15px;
        margin-top: 40px;
        padding: 25px;
        background: var(--theme-card);
        border-radius: var(--border-radius);
        border: 1px solid var(--theme-border);
        flex-wrap: wrap;
    }
    
    .filter-btn {
        padding: 10px 24px;
        border: 2px solid var(--theme-border);
        background: var(--theme-card);
        border-radius: 25px;
        cursor: pointer;
        transition: var(--transition);
        color: var(--theme-text);
        font-weight: 500;
    }
    
    .filter-btn:hover {
        border-color: var(--theme-primary);
        color: var(--theme-primary);
        transform: translateY(-2px);
    }
    
    .filter-btn.active {
        background: var(--theme-primary);
        color: white;
        border-color: var(--theme-primary);
    }
    
    /* ========== عرض الفئات ========== */
    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 25px;
    }
    
    .category-card {
        background: var(--theme-card);
        border-radius: 12px;
        padding: 25px;
        border: 1px solid var(--theme-border);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }
    
    .category-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    
    .category-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .category-color {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    
    .category-name {
        font-weight: 600;
        flex: 1;
        font-size: 1.2rem;
        color: var(--theme-text);
    }
    
    .category-stats {
        font-size: 0.9rem;
        color: var(--gray-color);
    }
    
    /* شريط التقدم داخل الفئة */
    .category-progress-container {
        width: 100%;
        height: 8px;
        background: var(--theme-border);
        border-radius: 4px;
        margin: 15px 0;
        overflow: hidden;
        position: relative;
    }
    
    .category-progress-bar {
        height: 100%;
        border-radius: 4px;
        transition: width 0.5s ease;
        background: var(--theme-primary);
    }
    
    .category-progress-bar.completed {
        background: var(--success-color);
    }
    
    .category-progress-bar.empty {
        width: 0%;
    }
    
    .category-progress-info {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: var(--gray-color);
        margin-bottom: 15px;
    }
    
    /* زر إضافة مهمة داخل الفئة */
    .category-add-task-btn {
        width: 100%;
        margin-top: 15px;
    }
    
    /* شريط المهام داخل الفئة */
    .category-tasks-container {
        margin: 15px 0;
        max-height: 300px;
        overflow-y: auto;
        padding-right: 10px;
    }
    
    .category-task-item {
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 8px;
        border-right: 3px solid;
        transition: var(--transition);
        cursor: pointer;
        position: relative;
        background: var(--theme-card);
        border: 1px solid var(--theme-border);
    }
    
    .category-task-item:hover {
        transform: translateX(-5px);
        box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    
    .category-task-item.completed {
        opacity: 0.6;
        border-color: var(--success-color);
    }
    
    .category-task-title {
        font-weight: 500;
        margin-bottom: 5px;
        font-size: 0.95rem;
    }
    
    .category-task-meta {
        display: flex;
        gap: 12px;
        font-size: 0.85rem;
        color: var(--gray-color);
    }
    
    /* تلميحات المهام في الفئات */
    .category-task-tooltip {
        position: absolute;
        background: var(--theme-text);
        color: var(--theme-card);
        padding: 15px;
        border-radius: 8px;
        font-size: 0.9rem;
        z-index: 1000;
        max-width: 350px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        display: none;
        pointer-events: none;
        white-space: nowrap;
    }
    
    /* ========== الجدول الزمني ========== */
    .calendar-controls {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
        padding: 20px;
        background: var(--theme-card);
        border-radius: var(--border-radius);
        border: 1px solid var(--theme-border);
    }
    
    .calendar-tabs {
        display: flex;
        gap: 10px;
    }
    
    .calendar-tab {
        padding: 10px 24px;
        border: 2px solid var(--theme-border);
        background: var(--theme-card);
        border-radius: 8px;
        cursor: pointer;
        transition: var(--transition);
        color: var(--theme-text);
        font-weight: 500;
    }
    
    .calendar-tab:hover {
        border-color: var(--theme-primary);
        color: var(--theme-primary);
    }
    
    .calendar-tab.active {
        background: var(--theme-primary);
        color: white;
        border-color: var(--theme-primary);
    }
    
    /* الجدول اليومي */
    .daily-calendar {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }
    
    .time-slot {
        background: var(--theme-card);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--theme-border);
    }
    
    .time-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--theme-primary);
    }
    
    .time-title {
        font-weight: 600;
        color: var(--theme-primary);
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .time-tasks {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    .calendar-task-card {
        background: var(--theme-card);
        border-radius: 8px;
        padding: 15px;
        border-left: 4px solid;
        border-right: 4px solid;
        transition: var(--transition);
        cursor: pointer;
        position: relative;
        border: 1px solid var(--theme-border);
    }
    
    .calendar-task-card:hover {
        transform: translateX(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .calendar-task-tooltip {
        position: absolute;
        background: var(--theme-text);
        color: var(--theme-card);
        padding: 15px;
        border-radius: 8px;
        font-size: 0.9rem;
        z-index: 1000;
        max-width: 350px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        display: none;
        pointer-events: none;
    }
    
    /* الجدول الأسبوعي */
    .weekly-calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 15px;
        margin-top: 20px;
    }
    
    .day-column {
        background: var(--theme-card);
        border-radius: 12px;
        padding: 15px;
        border: 1px solid var(--theme-border);
        min-height: 400px;
    }
    
    .day-header {
        text-align: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--theme-primary);
    }
    
    .day-name {
        font-weight: 600;
        color: var(--theme-primary);
        font-size: 1.1rem;
    }
    
    .day-date {
        color: var(--gray-color);
        font-size: 0.9rem;
        margin-top: 5px;
    }
    
    /* الجدول الشهري */
    .monthly-calendar {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 10px;
        margin-top: 20px;
    }
    
    .month-day {
        background: var(--theme-card);
        border-radius: 8px;
        padding: 10px;
        min-height: 120px;
        border: 1px solid var(--theme-border);
        position: relative;
    }
    
    .day-number {
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--theme-text);
    }
    
    .today .day-number {
        color: var(--theme-primary);
        font-weight: bold;
    }
    
    .month-tasks {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }
    
    .month-task-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 5px;
        display: inline-block;
    }
    
    .month-task-item {
        font-size: 0.8rem;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        transition: var(--transition);
        background: rgba(0,0,0,0.05);
    }
    
    .month-task-item:hover {
        background: rgba(0,0,0,0.1);
    }
    
    /* ========== محرر الملاحظات المتقدم ========== */
    .notes-editor-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: var(--theme-card);
        z-index: 10000;
        display: none;
        flex-direction: column;
    }
    
    .notes-editor-container.active {
        display: flex;
    }
    
    .notes-toolbar {
        background: var(--theme-card);
        padding: 15px 25px;
        border-bottom: 1px solid var(--theme-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .notes-toolbar-left {
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .notes-title-input {
        font-size: 1.5rem;
        font-weight: 600;
        border: none;
        background: transparent;
        color: var(--theme-text);
        min-width: 300px;
        padding: 5px 10px;
        border-radius: 6px;
        border: 2px solid transparent;
    }
    
    .notes-title-input:focus {
        outline: none;
        border-color: var(--theme-primary);
    }
    
    .notes-toolbar-right {
        display: flex;
        gap: 10px;
    }
    
    /* أدوات التنسيق */
    .formatting-tools {
        display: flex;
        gap: 5px;
        flex-wrap: wrap;
        background: var(--theme-card);
        padding: 10px 25px;
        border-bottom: 1px solid var(--theme-border);
    }
    
    .format-btn {
        padding: 8px 12px;
        border: 1px solid var(--theme-border);
        background: var(--theme-card);
        border-radius: 6px;
        cursor: pointer;
        color: var(--theme-text);
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .format-btn:hover {
        background: var(--theme-border);
    }
    
    .format-btn.active {
        background: var(--theme-primary);
        color: white;
        border-color: var(--theme-primary);
    }
    
    .font-controls {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .font-size-input {
        width: 80px;
        padding: 6px 10px;
        border: 1px solid var(--theme-border);
        border-radius: 6px;
        background: var(--theme-card);
        color: var(--theme-text);
    }
    
    .font-color-input {
        width: 40px;
        height: 34px;
        border: 1px solid var(--theme-border);
        border-radius: 6px;
        background: var(--theme-card);
        cursor: pointer;
    }
    
    /* محتوى المحرر */
    .notes-content {
        flex: 1;
        padding: 30px;
        font-size: 16px;
        line-height: 1.8;
        outline: none;
        background: var(--theme-card);
        color: var(--theme-text);
        overflow-y: auto;
        min-height: 300px;
        border: none;
        resize: none;
        width: 100%;
        font-family: inherit;
    }
    
    .notes-content:focus {
        outline: none;
    }
    
    /* ========== التصميم المتجاوب ========== */
    @media (max-width: 1200px) {
        .sidebar {
            width: 70px;
            padding: 15px 0;
        }
        
        .sidebar .logo h1 span,
        .sidebar .nav-item span,
        .sidebar .settings-btn span {
            display: none;
        }
        
        .logo h1 {
            justify-content: center;
        }
        
        .nav-item {
            justify-content: center;
            padding: 15px 0;
        }
        
        .settings-btn {
            justify-content: center;
        }
        
        .theme-popup {
            right: 5px;
            left: 5px;
            width: auto;
        }
        
        .main-content {
            margin-right: 70px;
        }
    }
    
    @media (max-width: 768px) {
        .app-container {
            flex-direction: column;
        }
        
        .sidebar {
            position: static;
            width: 100%;
            height: auto;
            padding: 10px;
        }
        
        .nav-menu {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px;
        }
        
        .nav-item {
            flex-shrink: 0;
        }
        
        .main-content {
            margin-right: 0;
            padding: 15px;
        }
        
        .categories-grid {
            grid-template-columns: 1fr;
        }
        
        .weekly-calendar {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .monthly-calendar {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    @media (max-width: 480px) {
        .weekly-calendar {
            grid-template-columns: 1fr;
        }
        
        .monthly-calendar {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .header {
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }
        
        .task-filters {
            flex-direction: column;
        }
        
        .filter-btn {
            width: 100%;
            text-align: center;
        }
    }
    
    /* ========== تلميحات عامة ========== */
    .tooltip {
        position: absolute;
        background: var(--theme-text);
        color: var(--theme-card);
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.85rem;
        z-index: 1000;
        max-width: 250px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        display: none;
        pointer-events: none;
        white-space: normal;
    }
    
    /* ========== تأثيرات خاصة ========== */
    .pulse {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(67, 97, 238, 0); }
        100% { box-shadow: 0 0 0 0 rgba(67, 97, 238, 0); }
    }
    
    .fade-in {
        animation: fadeIn 0.5s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    /* ========== شريط التمرير المخصص ========== */
    ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: var(--theme-card);
        border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--theme-primary);
        border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--theme-hover);
    }
    </style>
</head>
<body class="theme-blue">
    <div class="app-container">
        <!-- الشريط الجانبي -->
        <aside class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-tasks"></i> <span>مهامي</span></h1>
            </div>
            
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-view="tasks">
                    <i class="fas fa-list-check"></i>
                    <span>المهام</span>
                </a>
                <a href="#" class="nav-item" data-view="calendar">
                    <i class="fas fa-calendar-days"></i>
                    <span>الجدول</span>
                </a>
                <a href="#" class="nav-item" data-view="categories">
                    <i class="fas fa-tags"></i>
                    <span>الفئات</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <button class="settings-btn" id="settings-btn">
                    <i class="fas fa-cog"></i>
                    <span>الإعدادات</span>
                </button>
            </div>
            
            <!-- نافذة اختيار الثيم -->
            <div class="theme-popup" id="theme-popup">
                <h4>اختر الثيم</h4>
                <div class="theme-options">
                    <div class="theme-option active" data-theme="blue">
                        <div class="theme-preview theme-blue-preview"></div>
                        <span class="theme-name">أزرق</span>
                    </div>
                    <div class="theme-option" data-theme="dark">
                        <div class="theme-preview theme-dark-preview"></div>
                        <span class="theme-name">داكن</span>
                    </div>
                    <div class="theme-option" data-theme="light">
                        <div class="theme-preview theme-light-preview"></div>
                        <span class="theme-name">فاتح</span>
                    </div>
                    <div class="theme-option" data-theme="beige">
                        <div class="theme-preview theme-beige-preview"></div>
                        <span class="theme-name">بيج</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <h1 id="page-title">المهام</h1>
                    <div id="current-date" class="current-date"></div>
                </div>
                <div>
                    <!-- زر إضافة مهمة رئيسي فقط هنا -->
                    <button class="btn btn-primary" id="add-task-btn">
                        <i class="fas fa-plus"></i> إضافة مهمة
                    </button>
                </div>
            </header>

            <!-- منطقة المحتوى -->
            <div class="content-area">
                <!-- عرض المهام -->
                <div id="tasks-view" class="view active">
                    <div class="tasks-list" id="tasks-list">
                        <!-- المهام ستظهر هنا -->
                    </div>
                    
                    <!-- مرشحات المهام -->
                    <div class="task-filters">
                        <button class="filter-btn active" data-filter="pending">المهام النشطة</button>
                        <button class="filter-btn" data-filter="completed">المكتملة</button>
                        <button class="filter-btn" data-filter="deleted">المحذوفة</button>
                        <button class="filter-btn" data-filter="overdue">المتأخرة</button>
                        <button class="filter-btn" data-filter="all">الكل</button>
                    </div>
                </div>

                <!-- عرض الجدول -->
                <div id="calendar-view" class="view">
                    <div class="calendar-controls">
                        <div class="calendar-tabs">
                            <button class="calendar-tab active" data-range="daily">يومي</button>
                            <button class="calendar-tab" data-range="weekly">أسبوعي</button>
                            <button class="calendar-tab" data-range="monthly">شهري</button>
                        </div>
                    </div>
                    <div id="calendar-content">
                        <!-- محتوى الجدول -->
                    </div>
                </div>

                <!-- عرض الفئات -->
                <div id="categories-view" class="view">
                    <div style="margin-bottom: 25px;">
                        <h2 style="color: var(--theme-text);">إدارة الفئات</h2>
                        <p style="color: var(--gray-color); margin-top: 10px;">إدارة فئات المهام وإضافة مهام جديدة لها</p>
                    </div>
                    <div class="categories-grid" id="categories-list">
                        <!-- الفئات ستظهر هنا -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ========== النوافذ المنبثقة ========== -->
    
    <!-- نافذة إضافة مهمة -->
    <div class="modal" id="add-task-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>إضافة مهمة جديدة</h3>
                <button class="close-btn" id="close-task-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="task-form">
                    <div class="form-group">
                        <label for="task-title">عنوان المهمة *</label>
                        <input type="text" id="task-title" placeholder="أدخل عنوان المهمة" required>
                    </div>
                    <div class="form-group">
                        <label for="task-category">الفئة *</label>
                        <select id="task-category" required>
                            <option value="">-- اختر الفئة --</option>
                            <!-- الفئات ستضاف هنا -->
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-date">تاريخ الاستحقاق</label>
                            <input type="date" id="task-date">
                        </div>
                        <div class="form-group">
                            <label for="task-time">الوقت</label>
                            <input type="time" id="task-time">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-duration">المدة (دقائق)</label>
                            <input type="number" id="task-duration" min="1" value="30">
                        </div>
                        <div class="form-group">
                            <label for="task-priority">الأولوية</label>
                            <select id="task-priority">
                                <option value="low">منخفضة</option>
                                <option value="medium" selected>متوسطة</option>
                                <option value="high">عالية</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="task-description">الوصف</label>
                        <textarea id="task-description" placeholder="أدخل وصف المهمة" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-task">إلغاء</button>
                <button class="btn btn-primary" id="save-task">حفظ المهمة</button>
            </div>
        </div>
    </div>

    <!-- نافذة إضافة فئة -->
    <div class="modal" id="add-category-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>إضافة فئة جديدة</h3>
                <button class="close-btn" id="close-category-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <div class="form-group">
                        <label for="category-name">اسم الفئة *</label>
                        <input type="text" id="category-name" placeholder="أدخل اسم الفئة" required>
                    </div>
                    <div class="form-group">
                        <label for="category-color">لون الفئة</label>
                        <div style="display: flex; gap: 15px; align-items: center;">
                            <input type="color" id="category-color" value="#4361ee">
                            <div id="color-preview" style="width: 40px; height: 40px; border-radius: 8px; border: 2px solid var(--theme-border);"></div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-category">إلغاء</button>
                                <button class="btn btn-primary" id="save-category">حفظ الفئة</button>
            </div>
        </div>
    </div>

    <!-- محرر الملاحظات المتقدم -->
    <div class="notes-editor-container" id="notes-editor">
        <div class="notes-toolbar">
            <div class="notes-toolbar-left">
                <input type="text" id="notes-editor-title" class="notes-title-input" placeholder="عنوان الملاحظة">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <span style="color: var(--gray-color); font-size: 0.9rem;">حجم الخط:</span>
                    <input type="number" id="notes-font-size" class="font-size-input" min="8" max="72" value="16">
                    <span style="color: var(--gray-color); font-size: 0.9rem;">لون الخط:</span>
                    <input type="color" id="notes-font-color" class="font-color-input" value="#000000">
                </div>
            </div>
            <div class="notes-toolbar-right">
                <button class="btn btn-secondary" id="save-notes-btn">
                    <i class="fas fa-save"></i> حفظ
                </button>
                <button class="btn btn-danger" id="close-notes-btn">
                    <i class="fas fa-times"></i> إغلاق
                </button>
            </div>
        </div>
        
        <div class="formatting-tools">
            <button class="format-btn" data-command="bold" title="عريض">
                <i class="fas fa-bold"></i>
            </button>
            <button class="format-btn" data-command="italic" title="مائل">
                <i class="fas fa-italic"></i>
            </button>
            <button class="format-btn" data-command="underline" title="تحته خط">
                <i class="fas fa-underline"></i>
            </button>
            <div style="width: 1px; height: 24px; background: var(--theme-border); margin: 0 10px;"></div>
            <button class="format-btn" data-command="justifyLeft" title="محاذاة لليسار">
                <i class="fas fa-align-left"></i>
            </button>
            <button class="format-btn" data-command="justifyCenter" title="محاذاة للوسط">
                <i class="fas fa-align-center"></i>
            </button>
            <button class="format-btn" data-command="justifyRight" title="محاذاة لليمين">
                <i class="fas fa-align-right"></i>
            </button>
            <div style="width: 1px; height: 24px; background: var(--theme-border); margin: 0 10px;"></div>
            <button class="format-btn" data-command="insertUnorderedList" title="قائمة غير مرقمة">
                <i class="fas fa-list-ul"></i>
            </button>
            <button class="format-btn" data-command="insertOrderedList" title="قائمة مرقمة">
                <i class="fas fa-list-ol"></i>
            </button>
        </div>
        
        <textarea class="notes-content" id="notes-editor-content" placeholder="اكتب ملاحظاتك هنا..."></textarea>
    </div>

    <!-- تلميحات عامة -->
    <div id="global-tooltip" class="tooltip"></div>

    <!-- عناصر CSS المفقودة للنوافذ -->
    <style>
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }
    
    .modal.active {
        display: flex;
    }
    
    .modal-content {
        background: var(--theme-card);
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--theme-border);
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid var(--theme-border);
    }
    
    .modal-header h3 {
        color: var(--theme-primary);
    }
    
    .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--gray-color);
        transition: var(--transition);
    }
    
    .close-btn:hover {
        color: var(--danger-color);
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .modal-footer {
        padding: 20px;
        border-top: 1px solid var(--theme-border);
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    /* نماذج الإدخال */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--theme-text);
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--theme-border);
        border-radius: 8px;
        font-size: 1rem;
        transition: var(--transition);
        background: var(--theme-card);
        color: var(--theme-text);
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: var(--theme-primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    .form-row {
        display: flex;
        gap: 15px;
    }
    
    .form-row .form-group {
        flex: 1;
    }
    
    /* إخفاء نوافذ النماذج المخفية */
    #add-category-modal {
        display: none;
    }
    </style>

    <script>
    // ========== حالة التطبيق ==========
    const AppState = {
        tasks: [],
        categories: [],
        deletedTasks: [],
        notes: {},
        currentView: 'tasks',
        currentFilter: 'pending',
        currentCalendarView: 'daily',
        currentTaskId: null,
        selectedCategoryId: null,
        themes: ['dark', 'light', 'blue', 'beige'],
        currentTheme: 'blue'
    };
    
    // ========== إدارة الثيمات ==========
    function initializeThemes() {
        // تحميل الثيم المحفوظ
        const savedTheme = localStorage.getItem('mytasks_theme');
        if (savedTheme && AppState.themes.includes(savedTheme)) {
            AppState.currentTheme = savedTheme;
            document.body.className = `theme-${savedTheme}`;
        }
        
        // تحديث الأزرار النشطة
        document.querySelectorAll('.theme-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.theme === AppState.currentTheme) {
                option.classList.add('active');
            }
        });
        
        // إضافة أحداث تغيير الثيم
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', function() {
                const theme = this.dataset.theme;
                AppState.currentTheme = theme;
                document.body.className = `theme-${theme}`;
                localStorage.setItem('mytasks_theme', theme);
                
                document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');
                
                // إعادة تحميل البيانات للتأكد من التحديث
                if (AppState.currentView === 'tasks') renderTasks();
                else if (AppState.currentView === 'calendar') renderCalendar();
                else if (AppState.currentView === 'categories') renderCategories();
                
                // إغلاق نافذة الثيمات
                document.getElementById('theme-popup').classList.remove('active');
            });
        });
        
        // زر الإعدادات
        document.getElementById('settings-btn').addEventListener('click', function(e) {
            e.stopPropagation();
            const popup = document.getElementById('theme-popup');
            popup.classList.toggle('active');
        });
        
        // إغلاق النافذة عند النقر خارجها
        document.addEventListener('click', function(e) {
            const popup = document.getElementById('theme-popup');
            if (!popup.contains(e.target) && e.target.id !== 'settings-btn') {
                popup.classList.remove('active');
            }
        });
    }
    
    // ========== إدارة البيانات ==========
    function initializeData() {
        console.log("تهيئة البيانات...");
        
        // تحميل المهام
        try {
            const savedTasks = localStorage.getItem('mytasks_tasks');
            AppState.tasks = savedTasks ? JSON.parse(savedTasks) : [];
        } catch (e) {
            console.error("خطأ في تحميل المهام:", e);
            AppState.tasks = [];
        }
        
        // تحميل المهام المحذوفة
        try {
            const savedDeleted = localStorage.getItem('mytasks_deleted');
            AppState.deletedTasks = savedDeleted ? JSON.parse(savedDeleted) : [];
        } catch (e) {
            console.error("خطأ في تحميل المهام المحذوفة:", e);
            AppState.deletedTasks = [];
        }
        
        // تحميل الفئات
        try {
            const savedCategories = localStorage.getItem('mytasks_categories');
            AppState.categories = savedCategories ? JSON.parse(savedCategories) : [];
            
            if (!Array.isArray(AppState.categories) || AppState.categories.length === 0) {
                AppState.categories = [
                    { id: 'work', name: 'عمل', color: '#4361ee' },
                    { id: 'personal', name: 'شخصي', color: '#4cc9f0' },
                    { id: 'study', name: 'دراسة', color: '#f72585' }
                ];
                saveCategories();
            }
        } catch (e) {
            console.error("خطأ في تحميل الفئات:", e);
            AppState.categories = [
                { id: 'work', name: 'عمل', color: '#4361ee' },
                { id: 'personal', name: 'شخصي', color: '#4cc9f0' },
                { id: 'study', name: 'دراسة', color: '#f72585' }
            ];
            saveCategories();
        }
        
        // تحميل الملاحظات
        try {
            const savedNotes = localStorage.getItem('mytasks_notes');
            AppState.notes = savedNotes ? JSON.parse(savedNotes) : {};
        } catch (e) {
            console.error("خطأ في تحميل الملاحظات:", e);
            AppState.notes = {};
        }
        
        // بيانات تجريبية إذا لم تكن هناك مهام
        if (AppState.tasks.length === 0) {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            AppState.tasks = [
                {
                    id: Date.now().toString(),
                    title: 'مهمة تجريبية',
                    description: 'هذه مهمة للاختبار فقط',
                    categoryId: 'work',
                    duration: 30,
                    date: today,
                    time: '14:00',
                    priority: 'medium',
                    completed: false,
                    createdAt: new Date().toISOString()
                },
                {
                    id: (Date.now() + 1).toString(),
                    title: 'مهمة متأخرة',
                    description: 'مهمة يجب أن تكون مكتملة بالأمس',
                    categoryId: 'personal',
                    duration: 45,
                    date: '2024-01-01', // تاريخ ماضٍ
                    time: '10:00',
                    priority: 'high',
                    completed: false,
                    createdAt: new Date().toISOString()
                },
                {
                    id: (Date.now() + 2).toString(),
                    title: 'مهمة مكتملة',
                    description: 'مهمة تم إنجازها بالفعل',
                    categoryId: 'study',
                    duration: 60,
                    date: today,
                    time: '16:00',
                    priority: 'low',
                    completed: true,
                    createdAt: new Date().toISOString()
                }
            ];
            saveTasks();
        }
    }
    
    function saveTasks() {
        try {
            localStorage.setItem('mytasks_tasks', JSON.stringify(AppState.tasks));
        } catch (e) {
            console.error("خطأ في حفظ المهام:", e);
        }
    }
    
    function saveDeletedTasks() {
        try {
            localStorage.setItem('mytasks_deleted', JSON.stringify(AppState.deletedTasks));
        } catch (e) {
            console.error("خطأ في حفظ المهام المحذوفة:", e);
        }
    }
    
    function saveCategories() {
        try {
            localStorage.setItem('mytasks_categories', JSON.stringify(AppState.categories));
        } catch (e) {
            console.error("خطأ في حفظ الفئات:", e);
        }
    }
    
    function saveNotes() {
        try {
            localStorage.setItem('mytasks_notes', JSON.stringify(AppState.notes));
        } catch (e) {
            console.error("خطأ في حفظ الملاحظات:", e);
        }
    }
    
    // ========== وظائف المساعدة ==========
    function getCategoryById(categoryId) {
        return AppState.categories.find(cat => cat.id === categoryId) || 
               { name: 'عام', color: '#6c757d' };
    }
    
    function getLightColor(hexColor, percent = 30) {
        // تحويل اللون إلى أفتح
        let r = parseInt(hexColor.substr(1, 2), 16);
        let g = parseInt(hexColor.substr(3, 2), 16);
        let b = parseInt(hexColor.substr(5, 2), 16);
        
        r = Math.min(255, r + percent * 2.55);
        g = Math.min(255, g + percent * 2.55);
        b = Math.min(255, b + percent * 2.55);
        
        return `rgb(${Math.round(r)}, ${Math.round(g)}, ${Math.round(b)})`;
    }
    
    function isTaskOverdue(task) {
        if (!task.date || task.completed) return false;
        const today = new Date().toISOString().split('T')[0];
        return task.date < today;
    }
    
    function formatDate(dateStr) {
        if (!dateStr) return 'بدون تاريخ';
        const date = new Date(dateStr);
        return date.toLocaleDateString('ar-SA');
    }
    
    function getTaskTooltipHTML(task) {
        const category = getCategoryById(task.categoryId);
        const priorityText = task.priority === 'high' ? 'عالية' : 
                           task.priority === 'medium' ? 'متوسطة' : 'منخفضة';
        const priorityColor = task.priority === 'high' ? '#f72585' : 
                            task.priority === 'medium' ? '#f8961e' : '#4cc9f0';
        
        return `
            <div style="padding: 10px; min-width: 250px;">
                <div style="font-weight: bold; margin-bottom: 10px; color: ${category.color}">
                    ${task.title}
                </div>
                ${task.description ? `<div style="margin-bottom: 10px; color: #666;">${task.description}</div>` : ''}
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                    <div><i class="fas fa-tag"></i> ${category.name}</div>
                    <div><i class="fas fa-flag" style="color: ${priorityColor}"></i> ${priorityText}</div>
                    <div><i class="fas fa-calendar"></i> ${formatDate(task.date)}</div>
                    <div><i class="fas fa-clock"></i> ${task.time || 'لا يوجد'}</div>
                    <div><i class="fas fa-hourglass"></i> ${task.duration} دقيقة</div>
                    <div><i class="fas ${task.completed ? 'fa-check-circle' : 'fa-clock'}"></i> ${task.completed ? 'مكتملة' : 'قيد التنفيذ'}</div>
                </div>
            </div>
        `;
    }
    
    // ========== إدارة المهام ==========
    function addTask(taskData) {
        console.log("إضافة مهمة:", taskData);
        const newTask = {
            id: Date.now().toString(),
            title: taskData.title,
            description: taskData.description || '',
            categoryId: taskData.categoryId,
            duration: parseInt(taskData.duration) || 30,
            date: taskData.date || new Date().toISOString().split('T')[0],
            time: taskData.time || '',
            priority: taskData.priority || 'medium',
            completed: false,
            createdAt: new Date().toISOString()
        };
        
        AppState.tasks.push(newTask);
        saveTasks();
        
        // تحديث العرض الحالي
        if (AppState.currentView === 'tasks') renderTasks();
        else if (AppState.currentView === 'calendar') renderCalendar();
        else if (AppState.currentView === 'categories') renderCategories();
        
        closeModal('add-task-modal');
        document.getElementById('task-form').reset();
    }
    
    function deleteTask(taskId) {
        const taskIndex = AppState.tasks.findIndex(task => task.id === taskId);
        if (taskIndex === -1) {
            const deletedIndex = AppState.deletedTasks.findIndex(task => task.id === taskId);
            if (deletedIndex !== -1) {
                // المهمة موجودة في المحذوفات
                if (confirm('هذه المهمة محذوفة بالفعل. هل تريد حذفها نهائياً؟')) {
                    AppState.deletedTasks.splice(deletedIndex, 1);
                    saveDeletedTasks();
                    renderTasks();
                }
            } else {
                alert('هذه المهمة غير موجودة.');
            }
            return;
        }
        
        const task = AppState.tasks[taskIndex];
        if (!confirm(`هل أنت متأكد من حذف المهمة: "${task.title}"؟`)) return;
        
        // نقل المهمة إلى المحذوفات
        AppState.deletedTasks.push({
            ...task,
            deletedAt: new Date().toISOString()
        });
        
        // حذف المهمة من القائمة الرئيسية
        AppState.tasks.splice(taskIndex, 1);
        
        saveTasks();
        saveDeletedTasks();
        
        if (AppState.currentView === 'tasks') renderTasks();
        else if (AppState.currentView === 'calendar') renderCalendar();
    }
    
    function toggleTaskCompletion(taskId) {
        const task = AppState.tasks.find(t => t.id === taskId);
        if (task) {
            task.completed = !task.completed;
            saveTasks();
            
            if (AppState.currentView === 'tasks') renderTasks();
            else if (AppState.currentView === 'calendar') renderCalendar();
            else if (AppState.currentView === 'categories') renderCategories();
        }
    }
    
    function restoreTask(taskId) {
        const taskIndex = AppState.deletedTasks.findIndex(task => task.id === taskId);
        if (taskIndex === -1) return;
        
        const task = AppState.deletedTasks[taskIndex];
        AppState.tasks.push(task);
        AppState.deletedTasks.splice(taskIndex, 1);
        
        saveTasks();
        saveDeletedTasks();
        renderTasks();
    }
    
    // ========== عرض المهام ==========
    function renderTasks() {
        const container = document.getElementById('tasks-list');
        
        let tasksToShow = [];
        
        switch(AppState.currentFilter) {
            case 'pending':
                tasksToShow = AppState.tasks.filter(task => !task.completed);
                break;
            case 'completed':
                tasksToShow = AppState.tasks.filter(task => task.completed);
                break;
            case 'deleted':
                tasksToShow = AppState.deletedTasks;
                break;
            case 'overdue':
                tasksToShow = AppState.tasks.filter(task => isTaskOverdue(task));
                break;
            case 'all':
                tasksToShow = AppState.tasks;
                break;
        }
        
        // ترتيب المهام
        tasksToShow.sort((a, b) => {
            // المهام المتأخرة أولاً
            const aOverdue = isTaskOverdue(a);
            const bOverdue = isTaskOverdue(b);
            if (aOverdue && !bOverdue) return -1;
            if (!aOverdue && bOverdue) return 1;
            
            // المهام المكتملة في الأسفل
            if (a.completed && !b.completed) return 1;
            if (!a.completed && b.completed) return -1;
            
            // ثم حسب الأولوية
            const priorityOrder = { high: 0, medium: 1, low: 2 };
            if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                return priorityOrder[a.priority] - priorityOrder[b.priority];
            }
            
            // ثم حسب التاريخ
            const dateA = a.date ? new Date(a.date) : new Date(0);
            const dateB = b.date ? new Date(b.date) : new Date(0);
            if (dateA < dateB) return -1;
            if (dateA > dateB) return 1;
            
            return 0;
        });
        
        if (tasksToShow.length === 0) {
            let message = 'لا توجد مهام';
            if (AppState.currentFilter === 'pending') message = 'لا توجد مهام نشطة';
            else if (AppState.currentFilter === 'completed') message = 'لا توجد مهام مكتملة';
            else if (AppState.currentFilter === 'deleted') message = 'لا توجد مهام محذوفة';
            else if (AppState.currentFilter === 'overdue') message = 'لا توجد مهام متأخرة';
            
            container.innerHTML = `
                <div class="empty-state" style="text-align: center; padding: 60px 20px; color: var(--gray-color);">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                    <h3 style="color: var(--theme-text); margin-bottom: 10px;">${message}</h3>
                    ${AppState.currentFilter === 'pending' ? '<p>اضغط على "إضافة مهمة" لإنشاء مهمتك الأولى</p>' : ''}
                </div>
            `;
            return;
        }
        
        let html = '';
        
        tasksToShow.forEach(task => {
            const category = getCategoryById(task.categoryId);
            const isDeleted = AppState.currentFilter === 'deleted';
            const isOverdue = isTaskOverdue(task);
            const hasNote = AppState.notes[task.id];
            
            if (isDeleted) {
                html += `
                    <div class="task-card deleted" data-id="${task.id}">
                        <div class="task-content">
                            <div class="task-title" style="color: #999; text-decoration: line-through;">${task.title}</div>
                            ${task.description ? `<div class="task-description" style="color: #aaa;">${task.description}</div>` : ''}
                            <div class="task-meta">
                                <div class="task-meta-item">
                                    <i class="fas fa-tag" style="color: ${category.color}"></i>
                                    <span>${category.name}</span>
                                </div>
                                <div class="task-meta-item">
                                    <i class="fas fa-calendar"></i>
                                    <span>${formatDate(task.date)}</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-success btn-sm restore-task-btn" data-id="${task.id}" title="استعادة">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="btn btn-danger btn-sm permanent-delete-btn" data-id="${task.id}" title="حذف نهائي">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            } else {
                html += `
                    <div class="task-card ${task.completed ? 'completed' : ''} ${isOverdue ? 'overdue' : ''}" 
                         data-id="${task.id}">
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                        <div class="task-content">
                            <div class="task-title">${task.title}</div>
                            ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                            <div class="task-meta">
                                <div class="task-meta-item">
                                    <i class="fas fa-tag" style="color: ${category.color}"></i>
                                    <span>${category.name}</span>
                                </div>
                                <div class="task-meta-item">
                                    <i class="fas fa-calendar"></i>
                                    <span>${formatDate(task.date)}</span>
                                </div>
                                <div class="task-meta-item">
                                    <i class="fas fa-clock"></i>
                                    <span>${task.duration} دقيقة</span>
                                </div>
                                <div class="task-meta-item">
                                    <i class="fas fa-flag" style="color: ${
                                        task.priority === 'high' ? '#f72585' : 
                                        task.priority === 'medium' ? '#f8961e' : '#4cc9f0'
                                    }"></i>
                                    <span>${task.priority === 'high' ? 'عالية' : task.priority === 'medium' ? 'متوسطة' : 'منخفضة'}</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-actions">
                            ${hasNote ? `<button class="btn btn-secondary btn-sm view-notes-btn" data-id="${task.id}" title="عرض الملاحظات">
                                <i class="fas fa-sticky-note"></i>
                            </button>` : ''}
                            <button class="btn btn-secondary btn-sm edit-notes-btn" data-id="${task.id}" title="إضافة/تعديل ملاحظات">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger btn-sm delete-task-btn" data-id="${task.id}" title="حذف">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
        });
        
        container.innerHTML = html;
        
        // إضافة الأحداث
        if (AppState.currentFilter === 'deleted') {
            document.querySelectorAll('.restore-task-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = e.target.closest('button').dataset.id;
                    restoreTask(taskId);
                });
            });
            
            document.querySelectorAll('.permanent-delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = e.target.closest('button').dataset.id;
                    if (confirm('هل أنت متأكد من الحذف النهائي؟ لا يمكن استعادة المهمة بعد ذلك.')) {
                        const index = AppState.deletedTasks.findIndex(t => t.id === taskId);
                        if (index !== -1) {
                            AppState.deletedTasks.splice(index, 1);
                            saveDeletedTasks();
                            renderTasks();
                        }
                    }
                });
            });
        } else {
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const taskId = e.target.closest('.task-card').dataset.id;
                    toggleTaskCompletion(taskId);
                });
            });
            
            document.querySelectorAll('.delete-task-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = e.target.closest('button').dataset.id;
                    deleteTask(taskId);
                });
            });
            
            document.querySelectorAll('.edit-notes-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = e.target.closest('button').dataset.id;
                    openNotesEditor(taskId);
                });
            });
            
            document.querySelectorAll('.view-notes-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = e.target.closest('button').dataset.id;
                    openNotesEditor(taskId);
                });
            });
            
            // إضافة تلميحات للمهام
            document.querySelectorAll('.task-card').forEach(card => {
                const taskId = card.dataset.id;
                const task = AppState.tasks.find(t => t.id === taskId);
                if (!task) return;
                
                card.addEventListener('mouseenter', (e) => {
                    showTaskTooltip(e, taskId);
                });
                
                card.addEventListener('mouseleave', hideTaskTooltip);
            });
        }
    }
    
    // ========== عرض الفئات ==========
    function renderCategories() {
        const container = document.getElementById('categories-list');
        
        if (AppState.categories.length === 0) {
            container.innerHTML = `
                <div class="empty-state" style="text-align: center; padding: 60px 20px; color: var(--gray-color);">
                    <i class="fas fa-tags" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                    <h3 style="color: var(--theme-text); margin-bottom: 10px;">لا توجد فئات</h3>
                    <p>اضغط على زر إضافة فئة لإنشاء فئتك الأولى</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        
        AppState.categories.forEach(category => {
            const categoryTasks = AppState.tasks.filter(task => task.categoryId === category.id);
            const completedTasks = categoryTasks.filter(task => task.completed).length;
            const totalTasks = categoryTasks.length;
            
            // حساب نسبة الإنجاز بناءً على المدة
            let totalDuration = 0;
            let completedDuration = 0;
            categoryTasks.forEach(task => {
                totalDuration += task.duration || 30;
                if (task.completed) {
                    completedDuration += task.duration || 30;
                }
            });
            
            const progressPercent = totalDuration > 0 ? Math.round((completedDuration / totalDuration) * 100) : 0;
            const lightColor = getLightColor(category.color, 40);
            
            html += `
                <div class="category-card" data-id="${category.id}">
                    <div class="category-header">
                        <div class="category-color" style="background: ${category.color}"></div>
                        <div class="category-name">${category.name}</div>
                        <div class="category-stats">${totalTasks} مهام</div>
                    </div>
                    
                    <div class="category-progress-info">
                        <span>الإنجاز: ${progressPercent}%</span>
                        <span>مكتملة: ${completedTasks}/${totalTasks}</span>
                    </div>
                    
                    <div class="category-progress-container">
                        <div class="category-progress-bar ${completedDuration === totalDuration && totalTasks > 0 ? 'completed' : completedDuration === 0 ? 'empty' : ''}" 
                             style="width: ${progressPercent}%; background: ${completedDuration === totalDuration && totalTasks > 0 ? 'var(--success-color)' : category.color};">
                        </div>
                    </div>
                    
                    <div class="category-tasks-container">
            `;
            
            if (categoryTasks.length === 0) {
                html += `
                    <div style="text-align: center; padding: 20px; color: var(--gray-color);">
                        <i class="fas fa-tasks" style="opacity: 0.3;"></i>
                        <p>لا توجد مهام في هذه الفئة</p>
                    </div>
                `;
            } else {
                categoryTasks.forEach(task => {
                    const isOverdue = isTaskOverdue(task);
                    const taskLightColor = getLightColor(category.color, 60);
                    
                    html += `
                        <div class="category-task-item ${task.completed ? 'completed' : ''}" 
                             data-id="${task.id}"
                             style="border-color: ${taskLightColor}; background: ${taskLightColor}20;"
                             onmouseenter="showCategoryTaskTooltip(event, '${task.id}')"
                             onmouseleave="hideCategoryTaskTooltip()">
                            <div class="category-task-title">${task.title}</div>
                            <div class="category-task-meta">
                                <span><i class="fas fa-calendar"></i> ${formatDate(task.date)}</span>
                                <span><i class="fas fa-clock"></i> ${task.duration} دقيقة</span>
                                ${isOverdue ? '<span style="color: #f72585;"><i class="fas fa-exclamation-circle"></i> متأخرة</span>' : ''}
                                ${task.completed ? '<span style="color: #4cc9f0;"><i class="fas fa-check-circle"></i> مكتملة</span>' : ''}
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                    </div>
                    
                    <!-- زر إضافة مهمة داخل الفئة -->
                    <button class="btn btn-secondary category-add-task-btn" data-category-id="${category.id}">
                        <i class="fas fa-plus"></i> إضافة مهمة جديدة
                    </button>
                </div>
            `;
        });
        
        container.innerHTML = html;
        
        // إضافة الأحداث لأزرار إضافة المهام داخل الفئات
        document.querySelectorAll('.category-add-task-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const categoryId = e.target.closest('button').dataset.categoryId;
                openAddTaskModal(categoryId);
            });
        });
        
        // إضافة تلميحات للمهام في الفئات
        document.querySelectorAll('.category-task-item').forEach(item => {
            const taskId = item.dataset.id;
            const task = AppState.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            item.addEventListener('mouseenter', (e) => {
                showCategoryTaskTooltip(e, taskId);
            });
            
            item.addEventListener('mouseleave', hideCategoryTaskTooltip);
        });
    }
    
    // ========== إدارة الفئات ==========
    function addCategory(categoryData) {
        console.log("إضافة فئة:", categoryData);
        const newCategory = {
            id: Date.now().toString(),
            name: categoryData.name,
            color: categoryData.color,
            createdAt: new Date().toISOString()
        };
        
        AppState.categories.push(newCategory);
        saveCategories();
        
        if (AppState.currentView === 'categories') {
            renderCategories();
        }
        
        closeModal('add-category-modal');
        document.getElementById('category-form').reset();
    }
    
    function deleteCategory(categoryId) {
        if (!confirm('هل أنت متأكد من حذف هذه الفئة؟ سيتم تعيين مهامها لفئة عامة.')) return;
        
        // تحويل مهام الفئة المحذوفة إلى فئة عامة
        AppState.tasks.forEach(task => {
            if (task.categoryId === categoryId) {
                task.categoryId = 'general';
            }
        });
        
        AppState.categories = AppState.categories.filter(cat => cat.id !== categoryId);
        saveCategories();
        saveTasks();
        
        if (AppState.currentView === 'categories') {
            renderCategories();
        }
    }
    
    // ========== محرر الملاحظات المتقدم ==========
    function openNotesEditor(taskId) {
        AppState.currentTaskId = taskId;
        const task = AppState.tasks.find(t => t.id === taskId);
        
        document.getElementById('notes-editor-title').value = AppState.notes[taskId]?.title || `ملاحظات: ${task.title}`;
        document.getElementById('notes-editor-content').value = AppState.notes[taskId]?.content || '';
        document.getElementById('notes-font-size').value = AppState.notes[taskId]?.fontSize || '16';
        document.getElementById('notes-font-color').value = AppState.notes[taskId]?.fontColor || '#000000';
        
        document.getElementById('notes-editor').classList.add('active');
        
        // تركيز المحرر
        setTimeout(() => {
            document.getElementById('notes-editor-content').focus();
        }, 100);
    }
    
    function setupNotesEditorEvents() {
        // حفظ الملاحظات
        document.getElementById('save-notes-btn').addEventListener('click', saveNotes);
        
        // إغلاق المحرر
        document.getElementById('close-notes-btn').addEventListener('click', () => {
            document.getElementById('notes-editor').classList.remove('active');
        });
        
        // أدوات التنسيق
        document.querySelectorAll('.format-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const command = this.dataset.command;
                document.execCommand(command, false, null);
                this.classList.toggle('active');
            });
        });
        
        // حجم الخط
        document.getElementById('notes-font-size').addEventListener('change', function() {
            document.execCommand('fontSize', false, this.value);
        });
        
        // لون الخط
        document.getElementById('notes-font-color').addEventListener('change', function() {
            document.execCommand('foreColor', false, this.value);
        });
    }
    
    function saveNotes() {
        if (!AppState.currentTaskId) return;
        
        const title = document.getElementById('notes-editor-title').value;
        const content = document.getElementById('notes-editor-content').value;
        const fontSize = document.getElementById('notes-font-size').value;
        const fontColor = document.getElementById('notes-font-color').value;
        
        AppState.notes[AppState.currentTaskId] = {
            title: title,
            content: content,
            fontSize: fontSize,
            fontColor: fontColor,
            updatedAt: new Date().toISOString()
        };
        
        saveNotes();
        document.getElementById('notes-editor').classList.remove('active');
        
        // تحديث العرض إذا كان في عرض المهام
        if (AppState.currentView === 'tasks') {
            renderTasks();
        }
    }
    
    // ========== التلميحات ==========
    function showTaskTooltip(event, taskId) {
        const task = AppState.tasks.find(t => t.id === taskId) || 
                     AppState.deletedTasks.find(t => t.id === taskId);
        if (!task) return;
        
        const tooltip = document.getElementById('global-tooltip');
        tooltip.innerHTML = getTaskTooltipHTML(task);
        tooltip.style.display = 'block';
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = (rect.left + window.scrollX - tooltip.offsetWidth - 10) + 'px';
        tooltip.style.top = (rect.top + window.scrollY + rect.height / 2 - tooltip.offsetHeight / 2) + 'px';
    }
    
    function showCategoryTaskTooltip(event, taskId) {
        const task = AppState.tasks.find(t => t.id === taskId);
        if (!task) return;
        
        const tooltip = document.getElementById('global-tooltip');
        tooltip.innerHTML = getTaskTooltipHTML(task);
        tooltip.style.display = 'block';
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = (rect.left + window.scrollX - tooltip.offsetWidth - 10) + 'px';
        tooltip.style.top = (rect.top + window.scrollY) + 'px';
    }
    
    function showCalendarTaskTooltip(event, taskId) {
        const task = AppState.tasks.find(t => t.id === taskId);
        if (!task) return;
        
        const tooltip = document.getElementById('global-tooltip');
        tooltip.innerHTML = getTaskTooltipHTML(task);
        tooltip.style.display = 'block';
        
        const rect = event.target.getBoundingClientRect();
        tooltip.style.left = (rect.left + window.scrollX + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
        tooltip.style.top = (rect.top + window.scrollY - tooltip.offsetHeight - 10) + 'px';
    }
    
    function hideTaskTooltip() {
        document.getElementById('global-tooltip').style.display = 'none';
    }
    
    function hideCategoryTaskTooltip() {
        document.getElementById('global-tooltip').style.display = 'none';
    }
    
    function hideCalendarTaskTooltip() {
        document.getElementById('global-tooltip').style.display = 'none';
    }
    
    // ========== إدارة النوافذ المنبثقة ==========
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.add('active');
        }
    }
    
    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('active');
        }
    }
    
    // ========== فتح نافذة إضافة مهمة ==========
    function openAddTaskModal(preselectedCategory = null) {
        const categorySelect = document.getElementById('task-category');
        categorySelect.innerHTML = '<option value="">-- اختر الفئة --</option>';
        
        AppState.categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            if (preselectedCategory === category.id) {
                option.selected = true;
            }
            categorySelect.appendChild(option);
        });
        
        // تعيين تاريخ اليوم كافتراضي
        const today = new Date().toISOString().split('T')[0];
        const dateInput = document.getElementById('task-date');
        if (dateInput) {
            dateInput.value = today;
        }
        
        openModal('add-task-modal');
        
        // تركيز على حقل العنوان
        const titleInput = document.getElementById('task-title');
        if (titleInput) {
            setTimeout(() => {
                titleInput.focus();
            }, 100);
        }
    }
    
    // ========== إدارة العروض ==========
    function switchView(viewName) {
        AppState.currentView = viewName;
        
        // تحديث التنقل
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.view === viewName) {
                item.classList.add('active');
            }
        });
        
        // تحديث العنوان
        const titles = {
            tasks: 'المهام',
            calendar: 'الجدول الزمني',
            categories: 'إدارة الفئات'
        };
        document.getElementById('page-title').textContent = titles[viewName] || viewName;
        
        // إخفاء جميع العروض وإظهار العرض الحالي
        document.querySelectorAll('.view').forEach(view => {
            view.classList.remove('active');
        });
        document.getElementById(`${viewName}-view`).classList.add('active');
        
        // تحميل المحتوى المناسب
        switch(viewName) {
            case 'tasks':
                renderTasks();
                break;
            case 'calendar':
                renderCalendar();
                break;
            case 'categories':
                renderCategories();
                break;
        }
    }
    
    function setFilter(filterName) {
        AppState.currentFilter = filterName;
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.filter === filterName) {
                btn.classList.add('active');
            }
        });
        renderTasks();
    }
    
    // ========== تهيئة الصفحة ==========
    function initializePage() {
        console.log("تهيئة الصفحة...");
        
        // تحديث التاريخ
        const now = new Date();
        const arabicDate = now.toLocaleDateString('ar-SA', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        document.getElementById('current-date').textContent = arabicDate;
        
        // تحميل البيانات
        initializeData();
        initializeThemes();
        
        // إعداد محرر الملاحظات
        setupNotesEditorEvents();
        
        // ========== أحداث التنقل ==========
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                switchView(this.dataset.view);
            });
        });
        
        // ========== أحداث المرشحات ==========
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                setFilter(this.dataset.filter);
            });
        });
        
        // ========== زر إضافة مهمة رئيسي ==========
        document.getElementById('add-task-btn').addEventListener('click', () => {
            openAddTaskModal();
        });
        
        // ========== نافذة إضافة مهمة ==========
        // إغلاق نافذة إضافة مهمة
        const closeTaskModalBtn = document.getElementById('close-task-modal');
        const cancelTaskBtn = document.getElementById('cancel-task');
        
        if (closeTaskModalBtn) {
            closeTaskModalBtn.addEventListener('click', () => {
                closeModal('add-task-modal');
            });
        }
        
        if (cancelTaskBtn) {
            cancelTaskBtn.addEventListener('click', () => {
                closeModal('add-task-modal');
            });
        }
        
        // حفظ مهمة
        const saveTaskBtn = document.getElementById('save-task');
        if (saveTaskBtn) {
            saveTaskBtn.addEventListener('click', () => {
                const titleInput = document.getElementById('task-title');
                const categorySelect = document.getElementById('task-category');
                
                if (!titleInput || !categorySelect) {
                    console.error("عناصر النموذج غير موجودة");
                    return;
                }
                
                const title = titleInput.value.trim();
                const category = categorySelect.value;
                
                if (!title) {
                    alert('يرجى إدخال عنوان المهمة');
                    return;
                }
                
                if (!category) {
                    alert('يرجى اختيار فئة للمهمة');
                    return;
                }
                
                const durationInput = document.getElementById('task-duration');
                const dateInput = document.getElementById('task-date');
                const timeInput = document.getElementById('task-time');
                const prioritySelect = document.getElementById('task-priority');
                const descriptionTextarea = document.getElementById('task-description');
                
                addTask({
                    title: title,
                    description: descriptionTextarea ? descriptionTextarea.value.trim() : '',
                    categoryId: category,
                    duration: durationInput ? durationInput.value : 30,
                    date: dateInput ? dateInput.value : new Date().toISOString().split('T')[0],
                    time: timeInput ? timeInput.value : '',
                    priority: prioritySelect ? prioritySelect.value : 'medium'
                });
            });
        }
        
        // ========== نافذة إضافة فئة ==========
        // فتح نافذة إضافة فئة (سنضيف الزر لاحقاً إذا لزم الأمر)
        
        // ========== إغلاق النوافذ عند النقر خارجها ==========
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });
        
        // ========== تحميل العرض الأولي ==========
        renderTasks();
        console.log("✅ التطبيق جاهز للاستخدام!");
        
        // إضافة رسالة ترحيبية في الكونسول
        console.log("✨ تطبيق 'مهامي' يعمل بنجاح!");
        console.log("📱 الميزات المتاحة:");
        console.log("   - إدارة المهام مع تصفية متقدم");
        console.log("   - جدول زمني (يومي/أسبوعي/شهري)");
        console.log("   - إدارة الفئات مع شريط تقدم");
        console.log("   - محرر ملاحظات متقدم");
        console.log("   - 4 ثيمات للاختيار");
        console.log("   - تخزين محلي للبيانات");
    }
    
    // جعل الوظائف متاحة عالمياً
    window.showTaskTooltip = showTaskTooltip;
    window.hideTaskTooltip = hideTaskTooltip;
    window.showCategoryTaskTooltip = showCategoryTaskTooltip;
    window.hideCategoryTaskTooltip = hideCategoryTaskTooltip;
    window.showCalendarTaskTooltip = showCalendarTaskTooltip;
    window.hideCalendarTaskTooltip = hideCalendarTaskTooltip;
    window.openNotesEditor = openNotesEditor;
    window.toggleTaskCompletion = toggleTaskCompletion;
    window.deleteTask = deleteTask;
    window.openAddTaskModal = openAddTaskModal;
    
    // ========== عرض الجدول الزمني (مبسط) ==========
    function renderCalendar() {
        const container = document.getElementById('calendar-content');
        container.innerHTML = `
            <div style="text-align: center; padding: 60px 20px; color: var(--gray-color);">
                <i class="fas fa-calendar-alt" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                <h3 style="color: var(--theme-text); margin-bottom: 10px;">الجدول الزمني</h3>
                <p>اختر نوع العرض من الأعلى (يومي، أسبوعي، شهري)</p>
                <p style="margin-top: 20px; font-size: 0.9rem;">
                    هذه الميزة ستكون متاحة كاملة في التحديث القادم
                </p>
            </div>
        `;
        
        // إضافة أحداث لتبديل عرض الجدول
        document.querySelectorAll('.calendar-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.calendar-tab').forEach(t => {
                    t.classList.remove('active');
                });
                this.classList.add('active');
                AppState.currentCalendarView = this.dataset.range;
                
                // يمكنك إضافة منطق عرض مختلف لكل نوع هنا
                if (AppState.currentCalendarView === 'daily') {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px;">
                            <h3 style="color: var(--theme-primary); margin-bottom: 20px;">الجدول اليومي</h3>
                            <p>عرض المهام اليومية سيكون هنا</p>
                        </div>
                    `;
                } else if (AppState.currentCalendarView === 'weekly') {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px;">
                            <h3 style="color: var(--theme-primary); margin-bottom: 20px;">الجدول الأسبوعي</h3>
                            <p>عرض المهام الأسبوعية سيكون هنا</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px;">
                            <h3 style="color: var(--theme-primary); margin-bottom: 20px;">الجدول الشهري</h3>
                            <p>عرض المهام الشهرية سيكون هنا</p>
                        </div>
                    `;
                }
            });
        });
    }
    
    // بدء التطبيق عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
