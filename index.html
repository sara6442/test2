<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù‡Ø§Ù…ÙŠ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
        --primary: #4361ee; --secondary: #3a0ca3; --accent: #7209b7;
        --success: #4cc9f0; --danger: #f72585; --light: #f8f9fa;
        --dark: #212529; --gray: #6c757d;
    }
    body { font-family: 'Segoe UI', sans-serif; background: #f5f7fb; min-height: 100vh; }
    .container { display: flex; min-height: 100vh; direction: rtl; }
    
    /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ */
    .sidebar { width: 250px; background: linear-gradient(180deg, var(--primary), var(--secondary)); color: white; padding: 20px 0; }
    .logo { padding: 0 20px 30px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
    .logo h1 { display: flex; align-items: center; gap: 10px; font-size: 1.5rem; }
    .nav-item { display: flex; align-items: center; gap: 15px; padding: 15px; color: rgba(255,255,255,0.9); text-decoration: none; border-radius: 8px; margin: 0 15px 5px; transition: 0.3s; }
    .nav-item:hover { background: rgba(255,255,255,0.1); color: white; }
    .nav-item.active { background: rgba(255,255,255,0.2); color: white; font-weight: bold; }
    .nav-item i { width: 24px; text-align: center; }
    
    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    .main-content { flex: 1; margin-right: 250px; padding: 20px; }
    .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 20px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .header-left h2 { color: var(--primary); margin-bottom: 5px; }
    .date-display { color: var(--gray); font-size: 0.9rem; }
    
    /* Ø£Ø²Ø±Ø§Ø± */
    .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; transition: 0.3s; }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--secondary); transform: translateY(-2px); }
    .btn-secondary { background: var(--light); color: var(--dark); border: 1px solid #dee2e6; }
    .btn-danger { background: var(--danger); color: white; }
    .btn-sm { padding: 6px 12px; font-size: 0.9rem; }
    
    /* Ø´Ø±ÙŠØ· Ø§Ù„ÙˆÙ‚Øª */
    .time-navigation { display: flex; gap: 10px; margin-bottom: 20px; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .time-btn { flex: 1; padding: 10px; border: 2px solid #e9ecef; background: white; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .time-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
    .time-btn:hover { border-color: var(--primary); }
    
    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
    .content-area { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .view { display: none; }
    .active-view { display: block; }
    
    /* Ø§Ù„Ù…Ù‡Ø§Ù… */
    .tasks-list { display: flex; flex-direction: column; gap: 10px; }
    .task-item { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--light); border-radius: 8px; border-right: 4px solid var(--primary); transition: 0.3s; }
    .task-item:hover { transform: translateX(-5px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .task-item.completed { opacity: 0.7; border-color: var(--success); }
    .task-item.completed .task-title { text-decoration: line-through; }
    .task-checkbox { width: 20px; height: 20px; cursor: pointer; }
    .task-content { flex: 1; }
    .task-title { font-weight: bold; margin-bottom: 5px; }
    .task-description { color: var(--gray); font-size: 0.9rem; margin-bottom: 10px; }
    .task-meta { display: flex; gap: 15px; font-size: 0.85rem; color: var(--gray); }
    .task-actions { display: flex; gap: 10px; }
    
    /* Ø§Ù„Ù†ÙˆØ§ÙØ° */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: 10px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #dee2e6; }
    .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray); }
    .modal-body { padding: 20px; }
    .modal-footer { padding: 20px; border-top: 1px solid #dee2e6; display: flex; justify-content: flex-end; gap: 10px; }
    
    /* Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; font-size: 1rem; }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary); }
    .form-row { display: flex; gap: 15px; }
    .form-row .form-group { flex: 1; }
    
    /* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ÙØ§Ø±ØºØ© */
    .empty-state { text-align: center; padding: 40px 20px; color: var(--gray); }
    .empty-state i { margin-bottom: 20px; opacity: 0.5; }
    .empty-state h4 { margin-bottom: 10px; color: var(--dark); }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="logo"><h1><i class="fas fa-tasks"></i> Ù…Ù‡Ø§Ù…ÙŠ</h1></div>
            <nav class="main-nav">
                <a href="#" class="nav-item active" data-view="tasks"><i class="fas fa-list-check"></i> Ø§Ù„Ù…Ù‡Ø§Ù…</a>
                <a href="#" class="nav-item" data-view="calendar"><i class="fas fa-calendar-days"></i> Ø§Ù„Ø¬Ø¯ÙˆÙ„</a>
                <a href="#" class="nav-item" data-view="stats"><i class="fas fa-chart-pie"></i> Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a>
                <a href="#" class="nav-item" data-view="categories"><i class="fas fa-tags"></i> Ø§Ù„ÙØ¦Ø§Øª</a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="header-left">
                    <h2 id="current-view-title">Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
                    <div id="current-date" class="date-display"></div>
                </div>
                <div class="header-right">
                    <button class="btn btn-primary" id="add-task-btn"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
                </div>
            </header>

            <div class="time-navigation" id="time-navigation" style="display: none;">
                <button class="time-btn active" data-range="daily"><i class="fas fa-calendar-day"></i> Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
                <button class="time-btn" data-range="weekly"><i class="fas fa-calendar-week"></i> Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
                <button class="time-btn" data-range="monthly"><i class="fas fa-calendar-alt"></i> Ø§Ù„Ø´Ù‡Ø±ÙŠ</button>
            </div>

            <div class="content-area">
                <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… -->
                <div id="tasks-view" class="view active-view">
                    <div class="tasks-container">
                        <h3>Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</h3>
                        <div class="tasks-list" id="tasks-list">
                            <div class="empty-state">
                                <i class="fas fa-tasks fa-3x"></i>
                                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</h4>
                                <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
                <div id="calendar-view" class="view">
                    <div class="calendar-container">
                        <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</h3>
                        <p>Ø§Ø®ØªØ± Ø¹Ø±Ø¶Ø§Ù‹ Ø²Ù…Ù†ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰</p>
                    </div>
                </div>

                <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                <div id="stats-view" class="view">
                    <div class="stats-container">
                        <h3>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
                        <div id="stats-grid"></div>
                    </div>
                </div>

                <!-- Ø¹Ø±Ø¶ Ø§Ù„ÙØ¦Ø§Øª -->
                <div id="categories-view" class="view">
                    <div class="categories-container">
                        <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª</h3>
                        <button class="btn btn-secondary" id="add-category-btn"><i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©</button>
                        <div class="categories-list" id="categories-list"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© -->
    <div class="modal" id="add-task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button class="close-btn" id="close-task-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="task-form">
                    <div class="form-group">
                        <label for="task-title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø© *</label>
                        <input type="text" id="task-title" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©" required>
                    </div>
                    <div class="form-group">
                        <label for="task-description">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <textarea id="task-description" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø©" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-category">Ø§Ù„ÙØ¦Ø©</label>
                            <select id="task-category"></select>
                        </div>
                        <div class="form-group">
                            <label for="task-duration">Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                            <input type="number" id="task-duration" min="1" value="30">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-task">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" id="save-task">Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ù…Ø©</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© -->
    <div class="modal" id="add-category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <button class="close-btn" id="close-category-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <div class="form-group">
                        <label for="category-name">Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø© *</label>
                        <input type="text" id="category-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©" required>
                    </div>
                    <div class="form-group">
                        <label for="category-color">Ù„ÙˆÙ† Ø§Ù„ÙØ¦Ø©</label>
                        <input type="color" id="category-color" value="#4361ee">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-category">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn btn-primary" id="save-category">Ø­ÙØ¸ Ø§Ù„ÙØ¦Ø©</button>
            </div>
        </div>
    </div>

    <script>
    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† ==========
    class TaskManager {
        constructor() {
            console.log("ØªÙ‡ÙŠØ¦Ø© TaskManager...");
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚
            const tasksData = this.loadFromStorage('tasks');
            this.tasks = Array.isArray(tasksData) ? tasksData : [];
            console.log("Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø­Ù…Ù„Ø©:", this.tasks);
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø´Ø¯ÙŠØ¯
            const categoriesData = this.loadFromStorage('categories');
            console.log("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø®Ø§Ù…:", categoriesData);
            
            if (Array.isArray(categoriesData) && categoriesData.length > 0) {
                this.categories = categoriesData;
                console.log("Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø© Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†:", this.categories);
            } else {
                console.log("Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©");
                this.categories = this.getDefaultCategories();
            }
            
            // Ø§Ù„ØªØ£ÙƒØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
            if (!Array.isArray(this.categories)) {
                console.error("Ø§Ù„ÙØ¦Ø§Øª Ù„ÙŠØ³Øª Ù…ØµÙÙˆÙØ©ØŒ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†:", this.categories);
                this.categories = this.getDefaultCategories();
            }
            
            console.log("Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:", this.categories);
            this.initSampleData();
        }

        loadFromStorage(key) {
            try {
                const data = localStorage.getItem(key);
                if (!data) return null;
                return JSON.parse(data);
            } catch (e) {
                console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ${key}:`, e);
                return null;
            }
        }

        saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error(`Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ ${key}:`, e);
            }
        }

        getDefaultCategories() {
            return [
                {
                    id: 'personal',
                    name: 'Ù…Ù‡Ø§Ù… Ø´Ø®ØµÙŠØ©',
                    color: '#4361ee',
                    icon: 'fas fa-home'
                },
                {
                    id: 'work',
                    name: 'Ø¹Ù…Ù„',
                    color: '#f72585',
                    icon: 'fas fa-briefcase'
                },
                {
                    id: 'study',
                    name: 'Ø¯Ø±Ø§Ø³Ø©',
                    color: '#4cc9f0',
                    icon: 'fas fa-graduation-cap'
                }
            ];
        }

        initSampleData() {
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ù‡Ø§Ù…ØŒ Ø£Ø¶Ù Ù…Ù‡Ù…Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            if (this.tasks.length === 0) {
                this.tasks = [{
                    id: '1',
                    title: 'Ù…Ù‡Ù…Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©',
                    description: 'Ù‡Ø°Ù‡ Ù…Ù‡Ù…Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±',
                    categoryId: 'personal',
                    duration: 30,
                    date: new Date().toISOString().split('T')[0],
                    completed: false
                }];
                this.saveTasks();
            }
            
            // Ø­ÙØ¸ Ø§Ù„ÙØ¦Ø§Øª Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„ØªØ£ÙƒØ¯
            this.saveCategories();
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ù‡Ø§Ù…
        addTask(task) {
            if (!task.id) task.id = Date.now().toString();
            this.tasks.push(task);
            this.saveTasks();
            console.log("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©:", task);
        }

        deleteTask(taskId) {
            this.tasks = this.tasks.filter(task => task.id !== taskId);
            this.saveTasks();
        }

        getTasks() {
            return [...this.tasks];
        }

        getTaskById(taskId) {
            return this.tasks.find(task => task.id === taskId);
        }

        toggleTaskCompletion(taskId) {
            const task = this.getTaskById(taskId);
            if (task) {
                task.completed = !task.completed;
                this.saveTasks();
            }
        }

        saveTasks() {
            this.saveToStorage('tasks', this.tasks);
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ÙØ¦Ø§Øª
        addCategory(category) {
            if (!category.id) category.id = Date.now().toString();
            this.categories.push(category);
            this.saveCategories();
            console.log("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©:", category);
        }

        deleteCategory(categoryId) {
            this.categories = this.categories.filter(cat => cat.id !== categoryId);
            this.saveCategories();
        }

        getCategories() {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø¬Ø§Ø¹ Ù…ØµÙÙˆÙØ©
            return Array.isArray(this.categories) ? [...this.categories] : [];
        }

        getCategoryById(categoryId) {
            if (!Array.isArray(this.categories)) {
                console.error("this.categories Ù„ÙŠØ³ Ù…ØµÙÙˆÙØ©:", this.categories);
                return null;
            }
            return this.categories.find(cat => cat.id === categoryId);
        }

        saveCategories() {
            this.saveToStorage('categories', this.categories);
        }

        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø©
        getStatistics() {
            const tasks = this.getTasks();
            const categories = this.getCategories();
            
            return {
                totalTasks: tasks.length,
                completedTasks: tasks.filter(t => t.completed).length,
                pendingTasks: tasks.filter(t => !t.completed).length,
                categories: categories.map(cat => ({
                    ...cat,
                    taskCount: tasks.filter(t => t.categoryId === cat.id).length
                }))
            };
        }
    }

    // ========== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ==========
    class UI {
        constructor(taskManager) {
            this.taskManager = taskManager;
            this.currentView = 'tasks';
            this.initializeElements();
            this.setupEventListeners();
            this.initializeApp();
        }

        initializeElements() {
            this.elements = {
                currentDate: document.getElementById('current-date'),
                currentViewTitle: document.getElementById('current-view-title'),
                addTaskBtn: document.getElementById('add-task-btn'),
                addTaskModal: document.getElementById('add-task-modal'),
                closeTaskModal: document.getElementById('close-task-modal'),
                saveTaskBtn: document.getElementById('save-task'),
                taskTitle: document.getElementById('task-title'),
                taskDescription: document.getElementById('task-description'),
                taskCategory: document.getElementById('task-category'),
                taskDuration: document.getElementById('task-duration'),
                cancelTask: document.getElementById('cancel-task'),
                
                addCategoryBtn: document.getElementById('add-category-btn'),
                addCategoryModal: document.getElementById('add-category-modal'),
                closeCategoryModal: document.getElementById('close-category-modal'),
                saveCategoryBtn: document.getElementById('save-category'),
                categoryName: document.getElementById('category-name'),
                categoryColor: document.getElementById('category-color'),
                cancelCategory: document.getElementById('cancel-category'),
                
                navItems: document.querySelectorAll('.nav-item'),
                views: document.querySelectorAll('.view'),
                timeNavigation: document.getElementById('time-navigation'),
                timeButtons: document.querySelectorAll('.time-btn'),
                tasksList: document.getElementById('tasks-list'),
                statsGrid: document.getElementById('stats-grid'),
                categoriesList: document.getElementById('categories-list')
            };
        }

        setupEventListeners() {
            // Ø§Ù„ØªÙ†Ù‚Ù„
            this.elements.navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.switchView(item.dataset.view);
                });
            });

            // Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
            this.elements.addTaskBtn.addEventListener('click', () => this.openAddTaskModal());
            this.elements.closeTaskModal.addEventListener('click', () => this.closeModal('add-task-modal'));
            this.elements.saveTaskBtn.addEventListener('click', () => this.saveTask());
            this.elements.cancelTask.addEventListener('click', () => this.closeModal('add-task-modal'));

            // Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©
            this.elements.addCategoryBtn.addEventListener('click', () => this.openAddCategoryModal());
            this.elements.closeCategoryModal.addEventListener('click', () => this.closeModal('add-category-modal'));
            this.elements.saveCategoryBtn.addEventListener('click', () => this.saveCategory());
            this.elements.cancelCategory.addEventListener('click', () => this.closeModal('add-category-modal'));

            // Ø§Ù„ÙˆÙ‚Øª
            this.elements.timeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    this.elements.timeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                });
            });
        }

        initializeApp() {
            console.log("ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...");
            this.updateDate();
            this.switchView('tasks');
        }

        updateDate() {
            const now = new Date();
            const arabicDate = now.toLocaleDateString('ar-SA', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            this.elements.currentDate.textContent = arabicDate;
        }

        switchView(viewName) {
            console.log("ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø¥Ù„Ù‰:", viewName);
            this.currentView = viewName;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ù‚Ù„
            this.elements.navItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.view === viewName) {
                    item.classList.add('active');
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            const titles = {
                tasks: 'Ø§Ù„Ù…Ù‡Ø§Ù…',
                calendar: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ',
                stats: 'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª',
                categories: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª'
            };
            this.elements.currentViewTitle.textContent = titles[viewName];
            
            // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø´Ø±ÙŠØ· Ø§Ù„ÙˆÙ‚Øª
            this.elements.timeNavigation.style.display = (viewName === 'calendar') ? 'flex' : 'none';
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ø±ÙˆØ¶
            this.elements.views.forEach(view => {
                view.classList.remove('active-view');
                if (view.id === `${viewName}-view`) {
                    view.classList.add('active-view');
                }
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            switch(viewName) {
                case 'tasks':
                    this.loadTasksView();
                    break;
                case 'stats':
                    this.loadStatsView();
                    break;
                case 'categories':
                    this.loadCategoriesView();
                    break;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…
        loadTasksView() {
            console.log("ØªØ­Ù…ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù…...");
            const tasks = this.taskManager.getTasks();
            console.log("Ø§Ù„Ù…Ù‡Ø§Ù…:", tasks);
            
            if (!tasks || tasks.length === 0) {
                this.elements.tasksList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks fa-3x"></i>
                        <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</h4>
                        <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©" Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‡Ù…ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            tasks.forEach(task => {
                const category = this.taskManager.getCategoryById(task.categoryId);
                console.log(`Ø§Ù„Ù…Ù‡Ù…Ø© ${task.id} - Ø§Ù„ÙØ¦Ø©:`, category);
                
                html += `
                    <div class="task-item ${task.completed ? 'completed' : ''}" data-id="${task.id}">
                        <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''}>
                        <div class="task-content">
                            <div class="task-title">${task.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</div>
                            ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                            <div class="task-meta">
                                <span><i class="fas fa-tag" style="color: ${category?.color || '#000'}"></i> ${category?.name || 'Ø¹Ø§Ù…'}</span>
                                <span><i class="fas fa-clock"></i> ${task.duration || 30} Ø¯Ù‚ÙŠÙ‚Ø©</span>
                            </div>
                        </div>
                        <div class="task-actions">
                            <button class="btn btn-danger btn-sm delete-task" data-id="${task.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            this.elements.tasksList.innerHTML = html;
            
            // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù‡Ø§Ù…
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const taskId = e.target.closest('.task-item').dataset.id;
                    this.taskManager.toggleTaskCompletion(taskId);
                    this.loadTasksView();
                });
            });
            
            document.querySelectorAll('.delete-task').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const taskId = e.target.closest('button').dataset.id;
                    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ')) {
                        this.taskManager.deleteTask(taskId);
                        this.loadTasksView();
                    }
                });
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        loadStatsView() {
            console.log("ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...");
            const stats = this.taskManager.getStatistics();
            
            let html = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px;">
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; color: #4361ee; font-weight: bold;">${stats.totalTasks}</div>
                        <div style="color: #6c757d;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; color: #4cc9f0; font-weight: bold;">${stats.completedTasks}</div>
                        <div style="color: #6c757d;">Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø©</div>
                    </div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; text-align: center;">
                        <div style="font-size: 2rem; color: #f8961e; font-weight: bold;">${stats.pendingTasks}</div>
                        <div style="color: #6c757d;">Ù…Ù‡Ø§Ù… Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
                    </div>
                </div>
            `;
            
            this.elements.statsGrid.innerHTML = html;
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª
        loadCategoriesView() {
            console.log("ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª...");
            const categories = this.taskManager.getCategories();
            console.log("Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø­Ù…Ù„Ø©:", categories);
            
            if (!categories || categories.length === 0) {
                this.elements.categoriesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tags fa-3x"></i>
                        <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ¦Ø§Øª</h4>
                        <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©" Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙØ¦ØªÙƒ Ø§Ù„Ø£ÙˆÙ„Ù‰</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            categories.forEach(category => {
                html += `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px;">
                        <div style="width: 20px; height: 20px; background: ${category.color}; border-radius: 50%;"></div>
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">${category.name}</div>
                        </div>
                        <button class="btn btn-danger btn-sm delete-category" data-id="${category.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
            });
            
            this.elements.categoriesList.innerHTML = html;
            
            // Ø£Ø­Ø¯Ø§Ø« Ø­Ø°Ù Ø§Ù„ÙØ¦Ø§Øª
            document.querySelectorAll('.delete-category').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const categoryId = e.target.closest('button').dataset.id;
                    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©ØŸ')) {
                        this.taskManager.deleteCategory(categoryId);
                        this.loadCategoriesView();
                    }
                });
            });
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
        openAddTaskModal() {
            console.log("ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©");
            this.loadCategoryOptions();
            this.elements.addTaskModal.classList.add('active');
        }

        loadCategoryOptions() {
            const categories = this.taskManager.getCategories();
            console.log("Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØ¦Ø§Øª:", categories);
            
            const select = this.elements.taskCategory;
            select.innerHTML = '';
            
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                select.appendChild(option);
            });
            
            // Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù‡Ù†Ø§Ùƒ ÙØ¦Ø§ØªØŒ Ø£Ø¶Ù Ø®ÙŠØ§Ø±Ø§Ù‹ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            if (categories.length === 0) {
                const option = document.createElement('option');
                option.value = 'general';
                option.textContent = 'Ø¹Ø§Ù…';
                select.appendChild(option);
            }
        }

        saveTask() {
            const title = this.elements.taskTitle.value.trim();
            if (!title) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©');
                return;
            }
            
            const task = {
                id: Date.now().toString(),
                title: title,
                description: this.elements.taskDescription.value.trim(),
                categoryId: this.elements.taskCategory.value,
                duration: parseInt(this.elements.taskDuration.value) || 30,
                date: new Date().toISOString().split('T')[0],
                completed: false
            };
            
            console.log("Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ù…Ø©:", task);
            this.taskManager.addTask(task);
            this.closeModal('add-task-modal');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            this.elements.taskTitle.value = '';
            this.elements.taskDescription.value = '';
            this.elements.taskDuration.value = '30';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            if (this.currentView === 'tasks') {
                this.loadTasksView();
            }
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©
        openAddCategoryModal() {
            console.log("ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© ÙØ¦Ø©");
            this.elements.addCategoryModal.classList.add('active');
        }

        saveCategory() {
            const name = this.elements.categoryName.value.trim();
            if (!name) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙØ¦Ø©');
                return;
            }
            
            const category = {
                id: Date.now().toString(),
                name: name,
                color: this.elements.categoryColor.value
            };
            
            console.log("Ø­ÙØ¸ Ø§Ù„ÙØ¦Ø©:", category);
            this.taskManager.addCategory(category);
            this.closeModal('add-category-modal');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            this.elements.categoryName.value = '';
            this.elements.categoryColor.value = '#4361ee';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            if (this.currentView === 'categories') {
                this.loadCategoriesView();
            }
        }

        closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
    }

    // ========== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
    document.addEventListener('DOMContentLoaded', () => {
        console.log("Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...");
        
        try {
            const taskManager = new TaskManager();
            const ui = new UI(taskManager);
            
            console.log("âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!");
            
            // ÙØªØ­ Console Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
            console.log("=========================================");
            console.log("ğŸ¯ ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…!");
            console.log("ğŸ“± Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:");
            console.log("   - Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù Ø§Ù„Ù…Ù‡Ø§Ù…");
            console.log("   - Ø¥Ø¶Ø§ÙØ© ÙˆØ­Ø°Ù Ø§Ù„ÙØ¦Ø§Øª");
            console.log("   - Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª");
            console.log("   - ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            console.log("=========================================");
            
        } catch (error) {
            console.error("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:", error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
        }
    });
    </script>
</body>
</html>
