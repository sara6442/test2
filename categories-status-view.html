<!-- ملف categories-status-view.html -->
<div class="categories-status-container">
    <div class="categories-status-header">
        <div>
            <h2 style="color: var(--theme-text);">حالة الفئات</h2>
            <p style="color: var(--theme-text-light); margin-top: 10px;">عرض حالة الفئات والرسائل الخاصة بكل فئة</p>
        </div>
        <button class="btn btn-secondary" id="refresh-status-btn">
            <i class="fas fa-sync-alt"></i> تحديث الحالة
        </button>
    </div>
    <div class="categories-status-grid" id="categories-status-list">
        <!-- حالة الفئات ستظهر هنا -->
    </div>
</div>

<script>
// ========== عرض حالة الفئات ==========
function renderCategoriesStatus() {
    const container = document.getElementById('categories-status-list');
    
    if (AppState.categories.length === 0) {
        container.innerHTML = `
            <div class="empty-state" style="text-align: center; padding: 60px 20px; color: var(--theme-text-light); grid-column: 1 / -1;">
                <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                <h3 style="color: var(--theme-text); margin-bottom: 10px;">لا توجد فئات</h3>
                <p>اضغط على "فئة جديدة" في عرض الفئات لإنشاء فئتك الأولى</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    AppState.categories.forEach(category => {
        const categoryTasks = AppState.tasks.filter(task => task.categoryId === category.id);
        const completedTasks = categoryTasks.filter(task => task.completed).length;
        const totalTasks = categoryTasks.length;
        
        // تحديد حالة الفئة
        let statusMessage = '';
        let statusClass = '';
        
        if (totalTasks === 0) {
            statusMessage = category.messageEmpty || 'لا توجد مهام في هذه الفئة بعد.';
            statusClass = 'empty';
        } else if (completedTasks === totalTasks && totalTasks > 0) {
            statusMessage = category.messageCompleted || 'ممتاز! لقد أكملت جميع المهام في هذه الفئة.';
            statusClass = 'completed';
        } else {
            statusMessage = category.messagePending || `هناك ${totalTasks - completedTasks} مهام معلقة في هذه الفئة.`;
            statusClass = 'pending';
        }
        
        // تحديد نص الحيز الزمني
        let timeframeText = '';
        switch(category.timeframe) {
            case 'daily':
                timeframeText = 'يومي';
                break;
            case 'weekly':
                timeframeText = 'أسبوعي';
                break;
            case 'monthly':
                timeframeText = 'شهري';
                break;
            case 'quarterly':
                timeframeText = 'ربع سنوي';
                break;
            case 'yearly':
                timeframeText = 'سنوي';
                break;
            case 'custom':
                timeframeText = `${category.customDays || 7} يوم`;
                break;
            default:
                timeframeText = 'بدون حيز زمني';
        }
        
        html += `
            <div class="category-status-card ${statusClass}">
                <div class="category-status-header">
                    <div class="category-status-color" style="background: ${category.color}"></div>
                    <div class="category-status-name">${category.name}</div>
                    <div class="category-status-timeframe">${timeframeText}</div>
                </div>
                
                <div class="category-status-message">
                    ${statusMessage}
                </div>
                
                <div class="category-status-info">
                    <span>المهام: ${completedTasks}/${totalTasks}</span>
                    <span>الإنجاز: ${totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0}%</span>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
    
    // إضافة حدث زر التحديث
    const refreshBtn = document.getElementById('refresh-status-btn');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', () => {
            renderCategoriesStatus();
        });
    }
}

// ========== إدارة الفئات ==========
function openEditCategoryModal(categoryId) {
    const category = AppState.categories.find(c => c.id === categoryId);
    if (!category) return;
    
    AppState.currentCategoryId = categoryId;
    document.getElementById('category-modal-title').textContent = 'تعديل الفئة';
    document.getElementById('category-name').value = category.name;
    document.getElementById('category-color').value = category.color;
    document.getElementById('category-timeframe').value = category.timeframe || '';
    document.getElementById('custom-timeframe-days').value = category.customDays || '7';
    
    if (category.timeframe === 'custom') {
        document.getElementById('custom-timeframe-container').style.display = 'block';
    } else {
        document.getElementById('custom-timeframe-container').style.display = 'none';
    }
    
    document.getElementById('category-message-empty').value = category.messageEmpty || 'لا توجد مهام في هذه الفئة بعد. أضف مهام جديدة لبدء العمل!';
    document.getElementById('category-message-completed').value = category.messageCompleted || 'ممتاز! لقد أكملت جميع المهام في هذه الفئة. استمر في العمل الجيد!';
    document.getElementById('category-message-pending').value = category.messagePending || 'هناك مهام معلقة في هذه الفئة. واصل العمل لإنجازها!';
    
    document.getElementById('category-modal').classList.add('active');
}

function saveCategory() {
    const name = document.getElementById('category-name').value.trim();
    const color = document.getElementById('category-color').value;
    const timeframe = document.getElementById('category-timeframe').value;
    const customDays = document.getElementById('custom-timeframe-days').value;
    const messageEmpty = document.getElementById('category-message-empty').value.trim();
    const messageCompleted = document.getElementById('category-message-completed').value.trim();
    const messagePending = document.getElementById('category-message-pending').value.trim();
    
    if (!name) {
        alert('يرجى إدخال اسم الفئة');
        return;
    }
    
    if (!messageEmpty || !messageCompleted || !messagePending) {
        alert('يرجى إدخال جميع رسائل الفئة');
        return;
    }
    
    if (AppState.currentCategoryId) {
        // تعديل فئة موجودة
        const categoryIndex = AppState.categories.findIndex(c => c.id === AppState.currentCategoryId);
        if (categoryIndex !== -1) {
            AppState.categories[categoryIndex] = {
                ...AppState.categories[categoryIndex],
                name: name,
                color: color,
                timeframe: timeframe,
                customDays: timeframe === 'custom' ? parseInt(customDays) : 0,
                messageEmpty: messageEmpty,
                messageCompleted: messageCompleted,
                messagePending: messagePending
            };
            saveCategories();
            renderCategories();
            if (AppState.currentView === 'categories-status') {
                renderCategoriesStatus();
            }
        }
    } else {
        // إضافة فئة جديدة
        const newCategory = {
            id: generateId(),
            name: name,
            color: color,
            timeframe: timeframe,
            customDays: timeframe === 'custom' ? parseInt(customDays) : 0,
            messageEmpty: messageEmpty,
            messageCompleted: messageCompleted,
            messagePending: messagePending
        };
        
        AppState.categories.push(newCategory);
        saveCategories();
        renderCategories();
    }
    
    closeModal('category-modal');
}
</script>
