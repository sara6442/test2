<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مهامي - تطبيق المهام</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f5f7fb;
        color: #333;
        direction: rtl;
        min-height: 100vh;
    }
    
    .app-container {
        display: flex;
        min-height: 100vh;
    }
    
    /* الشريط الجانبي */
    .sidebar {
        width: 250px;
        background: linear-gradient(to bottom, #4361ee, #3a0ca3);
        color: white;
        padding: 20px 0;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }
    
    .logo {
        padding: 0 20px 30px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        margin-bottom: 30px;
    }
    
    .logo h1 {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5rem;
    }
    
    .nav-menu {
        padding: 0 15px;
    }
    
    .nav-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        border-radius: 8px;
        margin-bottom: 8px;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .nav-item:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }
    
    .nav-item.active {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        font-weight: bold;
    }
    
    .nav-item i {
        font-size: 1.2rem;
        width: 24px;
        text-align: center;
    }
    
    /* المحتوى الرئيسي */
    .main-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
    }
    
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 20px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .header h1 {
        color: #4361ee;
        margin-bottom: 5px;
    }
    
    .current-date {
        color: #666;
        font-size: 0.9rem;
    }
    
    /* أزرار */
    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        font-weight: 500;
    }
    
    .btn-primary {
        background: #4361ee;
        color: white;
    }
    
    .btn-primary:hover {
        background: #3a0ca3;
        transform: translateY(-2px);
    }
    
    .btn-secondary {
        background: #e9ecef;
        color: #333;
        border: 1px solid #ddd;
    }
    
    .btn-secondary:hover {
        background: #ddd;
    }
    
    .btn-danger {
        background: #f72585;
        color: white;
    }
    
    .btn-danger:hover {
        background: #d9048e;
    }
    
    .btn-sm {
        padding: 6px 12px;
        font-size: 0.9rem;
    }
    
    /* منطقة المحتوى */
    .content-area {
        background: white;
        border-radius: 12px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        min-height: 500px;
    }
    
    .view {
        display: none;
    }
    
    .view.active {
        display: block;
    }
    
    /* قائمة المهام */
    .tasks-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .task-card {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border-right: 4px solid #4361ee;
        transition: all 0.3s;
    }
    
    .task-card:hover {
        transform: translateX(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .task-card.completed {
        opacity: 0.7;
        border-color: #4cc9f0;
    }
    
    .task-card.completed .task-title {
        text-decoration: line-through;
    }
    
    .task-checkbox {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }
    
    .task-content {
        flex: 1;
    }
    
    .task-title {
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .task-description {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 10px;
    }
    
    .task-meta {
        display: flex;
        gap: 15px;
        font-size: 0.85rem;
        color: #666;
    }
    
    .task-actions {
        display: flex;
        gap: 10px;
    }
    
    /* النوافذ المنبثقة */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }
    
    .modal.active {
        display: flex;
    }
    
    .modal-content {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #eee;
    }
    
    .modal-header h3 {
        color: #4361ee;
    }
    
    .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: #666;
    }
    
    .close-btn:hover {
        color: #f72585;
    }
    
    .modal-body {
        padding: 20px;
    }
    
    .modal-footer {
        padding: 20px;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }
    
    /* نماذج الإدخال */
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #4361ee;
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }
    
    /* الفئات */
    .categories-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .category-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        transition: all 0.3s;
        border: 2px solid transparent;
    }
    
    .category-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        border-color: #4361ee;
    }
    
    .category-color {
        width: 20px;
        height: 20px;
        border-radius: 50%;
    }
    
    .category-name {
        font-weight: bold;
        flex: 1;
    }
    
    .category-actions {
        display: flex;
        gap: 10px;
    }
    
    /* إحصائيات */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }
    
    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #eee;
        transition: all 0.3s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .stat-icon {
        font-size: 2rem;
        margin-bottom: 15px;
        color: #4361ee;
    }
    
    .stat-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #4361ee;
        margin: 10px 0;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }
    
    /* شريط الوقت */
    .time-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .time-tab {
        flex: 1;
        padding: 10px;
        border: 2px solid #e9ecef;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
    }
    
    .time-tab:hover {
        border-color: #4361ee;
        color: #4361ee;
    }
    
    .time-tab.active {
        background: #4361ee;
        color: white;
        border-color: #4361ee;
    }
    
    /* حالة فارغة */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    
    .empty-state i {
        font-size: 3rem;
        margin-bottom: 20px;
        opacity: 0.3;
    }
    
    .empty-state h3 {
        margin-bottom: 10px;
        color: #333;
    }
    
    /* تصميم متجاوب */
    @media (max-width: 768px) {
        .app-container {
            flex-direction: column;
        }
        
        .sidebar {
            width: 100%;
            position: static;
        }
        
        .main-content {
            margin-right: 0;
        }
        
        .nav-menu {
            display: flex;
            overflow-x: auto;
            padding: 10px;
        }
        
        .nav-item {
            flex-shrink: 0;
        }
        
        .categories-grid {
            grid-template-columns: 1fr;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- الشريط الجانبي -->
        <aside class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-tasks"></i> مهامي</h1>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-view="tasks">
                    <i class="fas fa-list-check"></i>
                    <span>المهام</span>
                </a>
                <a href="#" class="nav-item" data-view="calendar">
                    <i class="fas fa-calendar-days"></i>
                    <span>الجدول</span>
                </a>
                <a href="#" class="nav-item" data-view="stats">
                    <i class="fas fa-chart-pie"></i>
                    <span>الإحصائيات</span>
                </a>
                <a href="#" class="nav-item" data-view="categories">
                    <i class="fas fa-tags"></i>
                    <span>الفئات</span>
                </a>
            </nav>
        </aside>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <header class="header">
                <div>
                    <h1 id="page-title">المهام</h1>
                    <div id="current-date" class="current-date"></div>
                </div>
                <div>
                    <button class="btn btn-primary" id="add-task-btn">
                        <i class="fas fa-plus"></i> إضافة مهمة
                    </button>
                </div>
            </header>

            <!-- شريط التبويب الزمني -->
            <div class="time-tabs" id="time-tabs" style="display: none;">
                <button class="time-tab active" data-range="daily">اليومي</button>
                <button class="time-tab" data-range="weekly">الأسبوعي</button>
                <button class="time-tab" data-range="monthly">الشهري</button>
            </div>

            <!-- منطقة المحتوى -->
            <div class="content-area">
                <!-- عرض المهام -->
                <div id="tasks-view" class="view active">
                    <h2>قائمة المهام</h2>
                    <div class="tasks-list" id="tasks-list">
                        <!-- المهام ستظهر هنا -->
                    </div>
                </div>

                <!-- عرض الجدول -->
                <div id="calendar-view" class="view">
                    <h2>الجدول الزمني</h2>
                    <div id="calendar-content">
                        <!-- محتوى الجدول -->
                    </div>
                </div>

                <!-- عرض الإحصائيات -->
                <div id="stats-view" class="view">
                    <h2>إحصائيات المهام</h2>
                    <div class="stats-grid" id="stats-grid">
                        <!-- الإحصائيات ستظهر هنا -->
                    </div>
                </div>

                <!-- عرض الفئات -->
                <div id="categories-view" class="view">
                    <h2>إدارة الفئات</h2>
                    <button class="btn btn-secondary" id="add-category-btn">
                        <i class="fas fa-plus"></i> إضافة فئة جديدة
                    </button>
                    <div class="categories-grid" id="categories-list">
                        <!-- الفئات ستظهر هنا -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- نافذة إضافة مهمة -->
    <div class="modal" id="add-task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>إضافة مهمة جديدة</h3>
                <button class="close-btn" id="close-task-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="task-form">
                    <div class="form-group">
                        <label for="task-title">عنوان المهمة *</label>
                        <input type="text" id="task-title" placeholder="أدخل عنوان المهمة" required>
                    </div>
                    <div class="form-group">
                        <label for="task-description">وصف المهمة (اختياري)</label>
                        <textarea id="task-description" placeholder="أدخل وصف المهمة" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="task-category">الفئة</label>
                        <select id="task-category">
                            <option value="personal">مهام شخصية</option>
                            <option value="work">عمل</option>
                            <option value="study">دراسة</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-duration">المدة (دقائق)</label>
                        <input type="number" id="task-duration" min="1" value="30">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-task">إلغاء</button>
                <button class="btn btn-primary" id="save-task">حفظ المهمة</button>
            </div>
        </div>
    </div>

    <!-- نافذة إضافة فئة -->
    <div class="modal" id="add-category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>إضافة فئة جديدة</h3>
                <button class="close-btn" id="close-category-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <div class="form-group">
                        <label for="category-name">اسم الفئة *</label>
                        <input type="text" id="category-name" placeholder="أدخل اسم الفئة" required>
                    </div>
                    <div class="form-group">
                        <label for="category-color">لون الفئة</label>
                        <input type="color" id="category-color" value="#4361ee">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-category">إلغاء</button>
                <button class="btn btn-primary" id="save-category">حفظ الفئة</button>
            </div>
        </div>
    </div>

    <script>
    // ========== التطبيق البسيط الذي يعمل ==========
    
    // حالة التطبيق
    const AppState = {
        tasks: [],
        categories: [],
        currentView: 'tasks'
    };
    
    // تهيئة البيانات
    function initializeData() {
        console.log("تهيئة البيانات...");
        
        // تحميل المهام من LocalStorage
        try {
            const savedTasks = localStorage.getItem('mytasks_tasks');
            AppState.tasks = savedTasks ? JSON.parse(savedTasks) : [];
            console.log("تم تحميل المهام:", AppState.tasks.length);
        } catch (e) {
            console.error("خطأ في تحميل المهام:", e);
            AppState.tasks = [];
        }
        
        // تحميل الفئات من LocalStorage أو إنشاء افتراضية
        try {
            const savedCategories = localStorage.getItem('mytasks_categories');
            AppState.categories = savedCategories ? JSON.parse(savedCategories) : [];
            
            // إذا لم تكن هناك فئات، أنشئ فئات افتراضية
            if (!Array.isArray(AppState.categories) || AppState.categories.length === 0) {
                console.log("إنشاء فئات افتراضية...");
                AppState.categories = [
                    { id: 'personal', name: 'مهام شخصية', color: '#4361ee', icon: 'fas fa-home' },
                    { id: 'work', name: 'عمل', color: '#f72585', icon: 'fas fa-briefcase' },
                    { id: 'study', name: 'دراسة', color: '#4cc9f0', icon: 'fas fa-graduation-cap' }
                ];
                saveCategories();
            }
            console.log("تم تحميل الفئات:", AppState.categories.length);
        } catch (e) {
            console.error("خطأ في تحميل الفئات:", e);
            AppState.categories = [
                { id: 'personal', name: 'مهام شخصية', color: '#4361ee' },
                { id: 'work', name: 'عمل', color: '#f72585' },
                { id: 'study', name: 'دراسة', color: '#4cc9f0' }
            ];
            saveCategories();
        }
        
        // إذا لم تكن هناك مهام، أضف مهمة تجريبية
        if (AppState.tasks.length === 0) {
            console.log("إنشاء مهمة تجريبية...");
            AppState.tasks = [
                {
                    id: Date.now().toString(),
                    title: 'مهمة تجريبية',
                    description: 'هذه مهمة للاختبار فقط',
                    categoryId: 'personal',
                    duration: 30,
                    date: new Date().toISOString().split('T')[0],
                    completed: false,
                    createdAt: new Date().toISOString()
                }
            ];
            saveTasks();
        }
    }
    
    // حفظ البيانات
    function saveTasks() {
        try {
            localStorage.setItem('mytasks_tasks', JSON.stringify(AppState.tasks));
            console.log("تم حفظ المهام");
        } catch (e) {
            console.error("خطأ في حفظ المهام:", e);
        }
    }
    
    function saveCategories() {
        try {
            localStorage.setItem('mytasks_categories', JSON.stringify(AppState.categories));
            console.log("تم حفظ الفئات");
        } catch (e) {
            console.error("خطأ في حفظ الفئات:", e);
        }
    }
    
    // الحصول على الفئة حسب المعرف
    function getCategoryById(categoryId) {
        return AppState.categories.find(cat => cat.id === categoryId) || 
               { name: 'عام', color: '#666', icon: 'fas fa-tag' };
    }
    
    // ========== عرض المهام ==========
    function renderTasks() {
        console.log("عرض المهام...");
        const container = document.getElementById('tasks-list');
        
        if (!AppState.tasks || AppState.tasks.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-tasks"></i>
                    <h3>لا توجد مهام</h3>
                    <p>اضغط على "إضافة مهمة" لإنشاء مهمتك الأولى</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        AppState.tasks.forEach(task => {
            const category = getCategoryById(task.categoryId);
            const isCompleted = task.completed || false;
            
            html += `
                <div class="task-card ${isCompleted ? 'completed' : ''}" data-id="${task.id}">
                    <input type="checkbox" class="task-checkbox" ${isCompleted ? 'checked' : ''}>
                    <div class="task-content">
                        <div class="task-title">${task.title || 'بدون عنوان'}</div>
                        ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                        <div class="task-meta">
                            <span><i class="fas fa-tag" style="color: ${category.color}"></i> ${category.name}</span>
                            <span><i class="fas fa-clock"></i> ${task.duration || 30} دقيقة</span>
                        </div>
                    </div>
                    <div class="task-actions">
                        <button class="btn btn-danger btn-sm delete-task-btn" data-id="${task.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
        
        // إضافة الأحداث للمهام
        document.querySelectorAll('.task-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function(e) {
                const taskId = e.target.closest('.task-card').dataset.id;
                toggleTaskCompletion(taskId);
            });
        });
        
        document.querySelectorAll('.delete-task-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                const taskId = e.target.closest('button').dataset.id;
                deleteTask(taskId);
            });
        });
    }
    
    // ========== عرض الفئات ==========
    function renderCategories() {
        console.log("عرض الفئات...");
        const container = document.getElementById('categories-list');
        
        if (!AppState.categories || AppState.categories.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-tags"></i>
                    <h3>لا توجد فئات</h3>
                    <p>اضغط على "إضافة فئة جديدة" لإنشاء فئتك الأولى</p>
                </div>
            `;
            return;
        }
        
        let html = '';
        AppState.categories.forEach(category => {
            const taskCount = AppState.tasks.filter(task => task.categoryId === category.id).length;
            
            html += `
                <div class="category-card" data-id="${category.id}">
                    <div class="category-color" style="background: ${category.color || '#4361ee'}"></div>
                    <div class="category-name">
                        <div>${category.name || 'فئة بدون اسم'}</div>
                        <small style="color: #666; font-size: 0.8rem;">${taskCount} مهام</small>
                    </div>
                    <div class="category-actions">
                        <button class="btn btn-danger btn-sm delete-category-btn" data-id="${category.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
        
        // إضافة الأحداث للفئات
        document.querySelectorAll('.delete-category-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                const categoryId = e.target.closest('button').dataset.id;
                deleteCategory(categoryId);
            });
        });
    }
    
    // ========== عرض الإحصائيات ==========
    function renderStats() {
        console.log("عرض الإحصائيات...");
        const container = document.getElementById('stats-grid');
        
        const totalTasks = AppState.tasks.length;
        const completedTasks = AppState.tasks.filter(task => task.completed).length;
        const pendingTasks = totalTasks - completedTasks;
        const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        const html = `
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                <div class="stat-value">${totalTasks}</div>
                <div class="stat-label">إجمالي المهام</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                <div class="stat-value">${completedTasks}</div>
                <div class="stat-label">مهام مكتملة</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-value">${pendingTasks}</div>
                <div class="stat-label">مهام قيد الانتظار</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                <div class="stat-value">${completionRate}%</div>
                <div class="stat-label">نسبة الإنجاز</div>
            </div>
        `;
        
        container.innerHTML = html;
    }
    
    // ========== الوظائف الأساسية ==========
    function addTask(taskData) {
        console.log("إضافة مهمة:", taskData);
        const newTask = {
            id: Date.now().toString(),
            title: taskData.title,
            description: taskData.description || '',
            categoryId: taskData.categoryId || 'personal',
            duration: parseInt(taskData.duration) || 30,
            date: new Date().toISOString().split('T')[0],
            completed: false,
            createdAt: new Date().toISOString()
        };
        
        AppState.tasks.push(newTask);
        saveTasks();
        
        if (AppState.currentView === 'tasks') {
            renderTasks();
        }
        
        closeModal('add-task-modal');
        document.getElementById('task-form').reset();
    }
    
    function deleteTask(taskId) {
        if (!confirm('هل أنت متأكد من حذف هذه المهمة؟')) return;
        
        console.log("حذف المهمة:", taskId);
        AppState.tasks = AppState.tasks.filter(task => task.id !== taskId);
        saveTasks();
        
        if (AppState.currentView === 'tasks') {
            renderTasks();
        }
        if (AppState.currentView === 'stats') {
            renderStats();
        }
    }
    
    function toggleTaskCompletion(taskId) {
        console.log("تبديل حالة المهمة:", taskId);
        const task = AppState.tasks.find(t => t.id === taskId);
        if (task) {
            task.completed = !task.completed;
            saveTasks();
            
            if (AppState.currentView === 'tasks') {
                renderTasks();
            }
            if (AppState.currentView === 'stats') {
                renderStats();
            }
        }
    }
    
    function addCategory(categoryData) {
        console.log("إضافة فئة:", categoryData);
        const newCategory = {
            id: Date.now().toString(),
            name: categoryData.name,
            color: categoryData.color || '#4361ee',
            icon: 'fas fa-tag',
            createdAt: new Date().toISOString()
        };
        
        AppState.categories.push(newCategory);
        saveCategories();
        
        if (AppState.currentView === 'categories') {
            renderCategories();
        }
        
        closeModal('add-category-modal');
        document.getElementById('category-form').reset();
    }
    
    function deleteCategory(categoryId) {
        if (!confirm('هل أنت متأكد من حذف هذه الفئة؟')) return;
        
        console.log("حذف الفئة:", categoryId);
        AppState.categories = AppState.categories.filter(cat => cat.id !== categoryId);
        saveCategories();
        
        if (AppState.currentView === 'categories') {
            renderCategories();
        }
    }
    
    // ========== إدارة العروض ==========
    function switchView(viewName) {
        console.log("تبديل العرض إلى:", viewName);
        AppState.currentView = viewName;
        
        // تحديث التنقل
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.view === viewName) {
                item.classList.add('active');
            }
        });
        
        // تحديث العنوان
        const titles = {
            tasks: 'المهام',
            calendar: 'الجدول الزمني',
            stats: 'الإحصائيات',
            categories: 'إدارة الفئات'
        };
        document.getElementById('page-title').textContent = titles[viewName] || viewName;
        
        // التحكم بشريط الوقت
        document.getElementById('time-tabs').style.display = (viewName === 'calendar') ? 'block' : 'none';
        
        // إخفاء جميع العروض وإظهار العرض الحالي
        document.querySelectorAll('.view').forEach(view => {
            view.classList.remove('active');
        });
        document.getElementById(`${viewName}-view`).classList.add('active');
        
        // تحميل المحتوى المناسب
        switch(viewName) {
            case 'tasks':
                renderTasks();
                break;
            case 'calendar':
                // عرض بسيط للتقويم
                document.getElementById('calendar-content').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar"></i>
                        <h3>الجدول الزمني</h3>
                        <p>اختر فترة زمنية من الأعلى لعرض المهام</p>
                    </div>
                `;
                break;
            case 'stats':
                renderStats();
                break;
            case 'categories':
                renderCategories();
                break;
        }
    }
    
    // ========== إدارة النوافذ ==========
    function openModal(modalId) {
        console.log("فتح نافذة:", modalId);
        document.getElementById(modalId).classList.add('active');
    }
    
    function closeModal(modalId) {
        console.log("إغلاق نافذة:", modalId);
        document.getElementById(modalId).classList.remove('active');
    }
    
    // ========== تهيئة الصفحة ==========
    function initializePage() {
        console.log("تهيئة الصفحة...");
        
        // تحديث التاريخ
        const now = new Date();
        const arabicDate = now.toLocaleDateString('ar-SA', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        document.getElementById('current-date').textContent = arabicDate;
        
        // تعيين التاريخ في حقل المهمة
        document.getElementById('task-date').value = now.toISOString().split('T')[0];
        
        // أحداث التنقل
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                switchView(this.dataset.view);
            });
        });
        
        // أحداث أزرار الوقت
        document.querySelectorAll('.time-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.time-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // إضافة مهمة
        document.getElementById('add-task-btn').addEventListener('click', () => {
            openModal('add-task-modal');
        });
        
        document.getElementById('close-task-modal').addEventListener('click', () => {
            closeModal('add-task-modal');
        });
        
        document.getElementById('cancel-task').addEventListener('click', () => {
            closeModal('add-task-modal');
        });
        
        document.getElementById('save-task').addEventListener('click', () => {
            const title = document.getElementById('task-title').value.trim();
            if (!title) {
                alert('يرجى إدخال عنوان المهمة');
                return;
            }
            
            addTask({
                title: title,
                description: document.getElementById('task-description').value.trim(),
                categoryId: document.getElementById('task-category').value,
                duration: document.getElementById('task-duration').value
            });
        });
        
        // إضافة فئة
        document.getElementById('add-category-btn').addEventListener('click', () => {
            openModal('add-category-modal');
        });
        
        document.getElementById('close-category-modal').addEventListener('click', () => {
            closeModal('add-category-modal');
        });
        
        document.getElementById('cancel-category').addEventListener('click', () => {
            closeModal('add-category-modal');
        });
        
        document.getElementById('save-category').addEventListener('click', () => {
            const name = document.getElementById('category-name').value.trim();
            if (!name) {
                alert('يرجى إدخال اسم الفئة');
                return;
            }
            
            addCategory({
                name: name,
                color: document.getElementById('category-color').value
            });
        });
        
        // إغلاق النوافذ عند النقر خارجها
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });
        
        // تحميل البيانات وعرضها
        initializeData();
        renderTasks();
        
        console.log("✅ التطبيق جاهز للاستخدام!");
    }
    
    // بدء التطبيق عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
